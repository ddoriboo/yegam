<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ìŠˆ ìƒì„¸ | ì˜ˆê²œ</title>
    <meta name="description" content="ì˜ˆê²œì—ì„œ ì´ìŠˆì˜ ìƒì„¸ ì •ë³´ì™€ ë² íŒ… í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.">
    
    <!-- Open Graph (SNS ê³µìœ ìš©) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ì˜ˆê²œ">
    <meta property="og:title" id="og-title" content="ì´ìŠˆ ìƒì„¸ | ì˜ˆê²œ">
    <meta property="og:description" id="og-description" content="ì˜ˆê²œì—ì„œ ì´ìŠˆì˜ ìƒì„¸ ì •ë³´ì™€ ë² íŒ… í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.">
    <meta property="og:image" id="og-image" content="/logo.png">
    <meta property="og:url" id="og-url" content="">
    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.6.0/kakao.min.js"></script>
    
    <style>
        .betting-bar {
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            overflow: hidden;
        }
        .betting-bar-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        .yes-fill { background: linear-gradient(90deg, #22c55e, #16a34a); }
        .no-fill { background: linear-gradient(90deg, #ef4444, #dc2626); }
        
        .countdown-timer {
            font-variant-numeric: tabular-nums;
        }
        
        .bet-button {
            transition: all 0.2s ease;
        }
        .bet-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .bet-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-active { background: #dcfce7; color: #166534; }
        .status-closed { background: #fef3c7; color: #92400e; }
        .status-settled { background: #dbeafe; color: #1e40af; }
        
        .share-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        .share-btn:hover {
            transform: scale(1.1);
        }
        
        .comment-item {
            border-bottom: 1px solid #f3f4f6;
            padding: 12px 0;
        }
        .comment-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

    <div id="app-container" class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="bg-white sticky top-0 border-b border-gray-200" style="z-index: 50000;">
            <nav class="container mx-auto px-4 lg:px-8 h-14 flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="flex items-center space-x-2">
                        <img src="logo.png" alt="ì˜ˆê²œ ë¡œê³ " class="h-7 w-auto" width="28" height="28">
                        <span class="text-lg font-bold text-gray-900">ì˜ˆê²œ</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-6 text-sm font-medium">
                        <a href="issues.html" class="text-gray-900 font-semibold">ì´ìŠˆ</a>
                        <a href="minigames.html" class="text-gray-600 hover:text-gray-900 transition-colors">ê²Œì„</a>
                        <a href="discussions.html" class="text-gray-600 hover:text-gray-900 transition-colors">ë¶„ì„</a>
                        <a href="tier_guide.html" class="text-gray-600 hover:text-gray-900 transition-colors">ì—…ì </a>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div id="header-user-actions" class="flex items-center space-x-2"></div>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <!-- Loading State -->
            <div id="loading-state" class="flex items-center justify-center py-20">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
            
            <!-- Error State -->
            <div id="error-state" class="hidden text-center py-20">
                <i data-lucide="alert-circle" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                <h2 class="text-xl font-semibold text-gray-700 mb-2">ì´ìŠˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
                <p class="text-gray-500 mb-4">ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ìŠˆì…ë‹ˆë‹¤.</p>
                <a href="issues.html" class="inline-flex items-center text-blue-600 hover:text-blue-700">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
                    ì´ìŠˆ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
            
            <!-- Issue Content -->
            <div id="issue-content" class="hidden">
                <div class="container mx-auto px-4 lg:px-8 py-4">
                    <!-- Back Button -->
                    <a href="issues.html" class="inline-flex items-center text-gray-500 hover:text-gray-700 text-sm mb-4 transition-colors">
                        <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
                        ëª©ë¡ìœ¼ë¡œ
                    </a>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column: Issue Info + Betting -->
                        <div class="lg:col-span-1 space-y-4">
                            <!-- Issue Card -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                <!-- Image -->
                                <div id="image-container" class="hidden">
                                    <img id="issue-image" src="" alt="" class="w-full h-40 object-cover">
                                </div>
                                
                                <div class="p-4">
                                    <!-- Category + Status -->
                                    <div class="flex items-center gap-2 mb-2">
                                        <span id="issue-category" class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded"></span>
                                        <span id="issue-status" class="status-badge"></span>
                                    </div>
                                    
                                    <!-- Title -->
                                    <h1 id="issue-title" class="text-lg font-bold text-gray-900 mb-2"></h1>
                                    <p id="issue-description" class="text-sm text-gray-600 mb-3"></p>
                                    
                                    <!-- Countdown -->
                                    <div id="countdown-section" class="bg-gray-50 rounded-lg p-3 mb-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-xs text-gray-500">ë§ˆê°ê¹Œì§€</span>
                                            <span id="countdown-timer" class="countdown-timer text-sm font-bold text-gray-900"></span>
                                        </div>
                                        <div class="text-xs text-gray-400 mt-1" id="deadline-date"></div>
                                    </div>
                                    
                                    <!-- Result (for settled) -->
                                    <div id="result-section" class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3 mb-3">
                                        <div class="flex items-center justify-center gap-2">
                                            <i data-lucide="trophy" class="w-5 h-5 text-yellow-500"></i>
                                            <span class="font-bold" id="result-text"></span>
                                        </div>
                                    </div>
                                    
                                    <!-- Betting Stats -->
                                    <div class="mb-4">
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="font-semibold text-green-600">YES <span id="yes-ratio">50</span>%</span>
                                            <span class="font-semibold text-red-600">NO <span id="no-ratio">50</span>%</span>
                                        </div>
                                        <div class="betting-bar">
                                            <div id="yes-bar" class="betting-bar-fill yes-fill" style="width: 50%"></div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span><span id="yes-amount">0</span>P</span>
                                            <span><span id="no-amount">0</span>P</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Stats -->
                                    <div class="grid grid-cols-3 gap-2 text-center border-t border-gray-100 pt-3">
                                        <div>
                                            <div class="text-base font-bold text-gray-900" id="participant-count">0</div>
                                            <div class="text-xs text-gray-500">ì°¸ì—¬ì</div>
                                        </div>
                                        <div>
                                            <div class="text-base font-bold text-gray-900" id="total-volume">0</div>
                                            <div class="text-xs text-gray-500">ì´ ë² íŒ…</div>
                                        </div>
                                        <div>
                                            <div class="text-base font-bold text-gray-900" id="comment-count">0</div>
                                            <div class="text-xs text-gray-500">ëŒ“ê¸€</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Betting Section -->
                            <div id="betting-section" class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                                <h2 class="text-base font-bold text-gray-900 mb-3">ë² íŒ…í•˜ê¸°</h2>
                                
                                <!-- My Bet Status -->
                                <div id="my-bet-status" class="hidden bg-blue-50 rounded-lg p-3 mb-3">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="check-circle" class="w-4 h-4 text-blue-600"></i>
                                        <span class="text-sm font-medium text-blue-800">
                                            ë‚˜ì˜ ë² íŒ…: <span id="my-bet-choice"></span> <span id="my-bet-amount"></span>P
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Odds -->
                                <div class="grid grid-cols-2 gap-3 mb-3">
                                    <div class="text-center p-2 bg-green-50 rounded-lg">
                                        <div class="text-xl font-bold text-green-600" id="yes-odds">2.00</div>
                                        <div class="text-xs text-green-600">YES ë°°ë‹¹</div>
                                    </div>
                                    <div class="text-center p-2 bg-red-50 rounded-lg">
                                        <div class="text-xl font-bold text-red-600" id="no-odds">2.00</div>
                                        <div class="text-xs text-red-600">NO ë°°ë‹¹</div>
                                    </div>
                                </div>
                                
                                <!-- Bet Input (ë¡œê·¸ì¸ ì‹œ) -->
                                <div id="bet-form">
                                    <div class="mb-3">
                                        <div class="flex gap-2">
                                            <input type="number" id="bet-amount" min="10" step="10" placeholder="ìµœì†Œ 10P" 
                                                class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <button onclick="setQuickBet(100)" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded">100</button>
                                            <button onclick="setQuickBet(500)" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded">500</button>
                                            <button onclick="setQuickBet(1000)" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded">1K</button>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-3">
                                        <button id="bet-yes-btn" onclick="placeBet('Yes')" 
                                            class="bet-button py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl text-sm">
                                            YES ë² íŒ…
                                        </button>
                                        <button id="bet-no-btn" onclick="placeBet('No')" 
                                            class="bet-button py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl text-sm">
                                            NO ë² íŒ…
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Login Prompt (ë¹„ë¡œê·¸ì¸ ì‹œ) -->
                                <div id="login-prompt" class="hidden text-center py-3">
                                    <p class="text-gray-600 text-sm mb-2">ë² íŒ…í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
                                    <a href="login.html" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700">
                                        ë¡œê·¸ì¸í•˜ê¸°
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Comments -->
                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h2 class="text-base font-bold text-gray-900">
                                        ëŒ“ê¸€ <span id="comments-count" class="text-gray-500 font-normal"></span>
                                    </h2>
                                </div>
                                
                                <!-- Comment Form -->
                                <div id="comment-form-container" class="mb-4">
                                    <div id="comment-form" class="hidden">
                                        <textarea id="comment-input" rows="2" placeholder="ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..." 
                                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
                                        <div class="flex justify-end mt-2">
                                            <button onclick="submitComment()" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700">
                                                ëŒ“ê¸€ ì‘ì„±
                                            </button>
                                        </div>
                                    </div>
                                    <div id="comment-login-prompt" class="hidden text-center py-3 bg-gray-50 rounded-lg">
                                        <p class="text-gray-600 text-sm">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a href="login.html" class="text-blue-600 hover:underline">ë¡œê·¸ì¸</a>í•˜ì„¸ìš”</p>
                                    </div>
                                </div>
                                
                                <!-- Comments List -->
                                <div id="comments-list" class="space-y-0">
                                    <div class="text-center py-8 text-gray-500 text-sm">
                                        ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                    </div>
                                </div>
                                
                                <!-- Load More -->
                                <div id="load-more-comments" class="hidden text-center mt-4">
                                    <button onclick="loadMoreComments()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                        ë” ë³´ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Share Section (ë§¨ ì•„ë˜) -->
                    <div class="mt-6 bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                        <h2 class="text-base font-bold text-gray-900 mb-3 text-center">ê³µìœ í•˜ê¸°</h2>
                        <div class="flex justify-center gap-4">
                            <button onclick="shareKakao()" class="share-btn bg-yellow-400 hover:bg-yellow-500" title="ì¹´ì¹´ì˜¤í†¡ ê³µìœ ">
                                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="#3C1E1E">
                                    <path d="M12 3C6.48 3 2 6.48 2 10.5c0 2.55 1.67 4.8 4.18 6.11-.18.64-.66 2.31-.76 2.67-.12.45.17.44.35.32.14-.1 2.19-1.48 3.08-2.08.37.05.75.08 1.15.08 5.52 0 10-3.48 10-7.5S17.52 3 12 3z"/>
                                </svg>
                            </button>
                            <button onclick="shareTwitter()" class="share-btn bg-black hover:bg-gray-800 text-white" title="X(íŠ¸ìœ„í„°) ê³µìœ ">
                                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                            </button>
                            <button onclick="copyLink()" class="share-btn bg-gray-200 hover:bg-gray-300" title="ë§í¬ ë³µì‚¬">
                                <i data-lucide="link" class="w-5 h-5 text-gray-700"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 py-4 mt-auto">
            <div class="container mx-auto px-4 text-center text-sm text-gray-500">
                <p>Â© 2026 ì˜ˆê²œ. ê°€ìƒ ì˜ˆì¸¡ í”Œë«í¼</p>
            </div>
        </footer>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <span id="toast-message"></span>
    </div>

    <script src="js/auth.js"></script>
    <script>
        let currentIssue = null;
        let currentUser = null;
        let commentsPage = 1;
        const COMMENTS_PER_PAGE = 10;
        
        // í† í° ê°€ì ¸ì˜¤ê¸° (ì—¬ëŸ¬ í‚¤ ì‹œë„)
        function getToken() {
            return localStorage.getItem('yegame-token') || localStorage.getItem('token');
        }
        
        // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getCurrentUser() {
            const userStr = localStorage.getItem('yegame-user') || localStorage.getItem('user');
            if (userStr) {
                try {
                    return JSON.parse(userStr);
                } catch (e) {}
            }
            return null;
        }
        
        // URLì—ì„œ ì´ìŠˆ ID ì¶”ì¶œ
        function getIssueId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }
        
        // ì´ìŠˆ ë°ì´í„° ë¡œë“œ
        async function loadIssue() {
            const issueId = getIssueId();
            if (!issueId) {
                showError();
                return;
            }
            
            try {
                const token = getToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                
                const response = await fetch(`/api/issues/${issueId}`, { headers });
                const data = await response.json();
                
                if (!data.success) {
                    showError();
                    return;
                }
                
                currentIssue = data.issue;
                currentUser = getCurrentUser();
                renderIssue(data.issue);
                loadComments();
                
            } catch (error) {
                console.error('ì´ìŠˆ ë¡œë“œ ì‹¤íŒ¨:', error);
                showError();
            }
        }
        
        // ì´ìŠˆ ë Œë”ë§
        function renderIssue(issue) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('issue-content').classList.remove('hidden');
            
            // ë©”íƒ€ íƒœê·¸
            document.title = `${issue.title} | ì˜ˆê²œ`;
            
            // ê¸°ë³¸ ì •ë³´
            document.getElementById('issue-title').textContent = issue.title;
            document.getElementById('issue-category').textContent = issue.category;
            document.getElementById('issue-description').textContent = issue.description || '';
            
            // ì´ë¯¸ì§€
            if (issue.image_url) {
                document.getElementById('image-container').classList.remove('hidden');
                document.getElementById('issue-image').src = issue.image_url;
            }
            
            // ìƒíƒœ
            const statusEl = document.getElementById('issue-status');
            if (issue.status === 'active') {
                statusEl.className = 'status-badge status-active';
                statusEl.textContent = 'ì§„í–‰ì¤‘';
            } else if (issue.status === 'closed') {
                statusEl.className = 'status-badge status-closed';
                statusEl.textContent = 'ë§ˆê°';
            } else {
                statusEl.className = 'status-badge status-settled';
                statusEl.textContent = 'ì •ì‚°ì™„ë£Œ';
            }
            
            // ì¹´ìš´íŠ¸ë‹¤ìš´
            updateCountdown(issue);
            
            // ê²°ê³¼ (ì •ì‚°ëœ ê²½ìš°)
            if (issue.result) {
                document.getElementById('countdown-section').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');
                const resultText = document.getElementById('result-text');
                resultText.textContent = issue.result === 'yes' ? 'ğŸ‰ YES ìŠ¹ë¦¬!' : 'ğŸ‰ NO ìŠ¹ë¦¬!';
                resultText.className = issue.result === 'yes' ? 'font-bold text-green-600' : 'font-bold text-red-600';
            }
            
            // ë² íŒ… í†µê³„
            document.getElementById('yes-ratio').textContent = issue.yesRatio;
            document.getElementById('no-ratio').textContent = issue.noRatio;
            document.getElementById('yes-bar').style.width = `${issue.yesRatio}%`;
            document.getElementById('yes-amount').textContent = (issue.yesAmount || 0).toLocaleString();
            document.getElementById('no-amount').textContent = (issue.noAmount || 0).toLocaleString();
            document.getElementById('yes-odds').textContent = issue.yesOdds.toFixed(2);
            document.getElementById('no-odds').textContent = issue.noOdds.toFixed(2);
            
            // í†µê³„
            document.getElementById('participant-count').textContent = (issue.participantCount || 0).toLocaleString();
            document.getElementById('total-volume').textContent = (issue.totalVolume || 0).toLocaleString() + 'P';
            document.getElementById('comment-count').textContent = (issue.commentCount || 0).toLocaleString();
            
            // ë‚´ ë² íŒ…
            if (issue.myBet) {
                document.getElementById('my-bet-status').classList.remove('hidden');
                const choiceEl = document.getElementById('my-bet-choice');
                choiceEl.textContent = issue.myBet.choice;
                choiceEl.className = issue.myBet.choice === 'Yes' ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
                document.getElementById('my-bet-amount').textContent = issue.myBet.amount.toLocaleString();
            }
            
            // ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ UI
            const isLoggedIn = !!getToken();
            const canBet = issue.status === 'active';
            
            if (!isLoggedIn) {
                document.getElementById('bet-form').classList.add('hidden');
                document.getElementById('login-prompt').classList.remove('hidden');
                document.getElementById('comment-form').classList.add('hidden');
                document.getElementById('comment-login-prompt').classList.remove('hidden');
            } else {
                document.getElementById('bet-form').classList.remove('hidden');
                document.getElementById('login-prompt').classList.add('hidden');
                document.getElementById('comment-form').classList.remove('hidden');
                document.getElementById('comment-login-prompt').classList.add('hidden');
                
                if (!canBet) {
                    document.getElementById('bet-yes-btn').disabled = true;
                    document.getElementById('bet-no-btn').disabled = true;
                    document.getElementById('bet-amount').disabled = true;
                }
            }
            
            lucide.createIcons();
        }
        
        // ì¹´ìš´íŠ¸ë‹¤ìš´
        function updateCountdown(issue) {
            const endDate = new Date(issue.end_date);
            document.getElementById('deadline-date').textContent = endDate.toLocaleString('ko-KR');
            
            function tick() {
                const now = new Date();
                const diff = endDate - now;
                
                if (diff <= 0) {
                    document.getElementById('countdown-timer').textContent = 'ë§ˆê°ë¨';
                    return;
                }
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                let text = '';
                if (days > 0) text += `${days}ì¼ `;
                if (hours > 0 || days > 0) text += `${hours}ì‹œê°„ `;
                text += `${minutes}ë¶„ ${seconds}ì´ˆ`;
                
                document.getElementById('countdown-timer').textContent = text;
            }
            
            tick();
            setInterval(tick, 1000);
        }
        
        // ì—ëŸ¬
        function showError() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('error-state').classList.remove('hidden');
            lucide.createIcons();
        }
        
        // í€µ ë² íŒ…
        function setQuickBet(amount) {
            document.getElementById('bet-amount').value = amount;
        }
        
        // ë² íŒ…
        async function placeBet(choice) {
            const amount = parseInt(document.getElementById('bet-amount').value);
            if (!amount || amount < 10) {
                showToast('ìµœì†Œ 10P ì´ìƒ ë² íŒ…í•´ì£¼ì„¸ìš”');
                return;
            }
            
            const token = getToken();
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const response = await fetch('/api/betting/place', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        issueId: currentIssue.id,
                        choice,
                        amount
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`${choice} ${amount}P ë² íŒ… ì™„ë£Œ!`);
                    setTimeout(() => loadIssue(), 500);
                } else {
                    showToast(data.message || 'ë² íŒ… ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë² íŒ… ì‹¤íŒ¨:', error);
                showToast('ë² íŒ… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ëŒ“ê¸€ ë¡œë“œ
        async function loadComments(append = false) {
            const issueId = getIssueId();
            
            try {
                const response = await fetch(`/api/comments/${issueId}?page=${commentsPage}&limit=${COMMENTS_PER_PAGE}`);
                const data = await response.json();
                
                if (data.success) {
                    renderComments(data.comments, append);
                    document.getElementById('comments-count').textContent = `(${data.total || data.comments.length})`;
                    
                    // ë”ë³´ê¸° ë²„íŠ¼
                    if (data.comments.length >= COMMENTS_PER_PAGE) {
                        document.getElementById('load-more-comments').classList.remove('hidden');
                    } else {
                        document.getElementById('load-more-comments').classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('comments-list').innerHTML = '<p class="text-center py-4 text-gray-500 text-sm">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</p>';
            }
        }
        
        // ëŒ“ê¸€ ë Œë”ë§
        function renderComments(comments, append = false) {
            const container = document.getElementById('comments-list');
            
            if (!append) {
                container.innerHTML = '';
            }
            
            if (comments.length === 0 && !append) {
                container.innerHTML = '<p class="text-center py-8 text-gray-500 text-sm">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
                return;
            }
            
            comments.forEach(comment => {
                const div = document.createElement('div');
                div.className = 'comment-item';
                div.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0">
                            <span class="text-sm font-medium text-gray-600">${(comment.username || 'ìµëª…')[0]}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="font-medium text-sm text-gray-900">${comment.username || 'ìµëª…'}</span>
                                <span class="text-xs text-gray-400">${formatTime(comment.created_at)}</span>
                            </div>
                            <p class="text-sm text-gray-700">${escapeHtml(comment.content)}</p>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        // ë” ë³´ê¸°
        function loadMoreComments() {
            commentsPage++;
            loadComments(true);
        }
        
        // ëŒ“ê¸€ ì‘ì„±
        async function submitComment() {
            const input = document.getElementById('comment-input');
            const content = input.value.trim();
            
            if (!content) {
                showToast('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            const token = getToken();
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const response = await fetch(`/api/comments/${getIssueId()}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ content })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    input.value = '';
                    commentsPage = 1;
                    loadComments();
                    showToast('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
                } else {
                    showToast(data.message || 'ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨:', error);
                showToast('ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ê³µìœ  - ì¹´ì¹´ì˜¤
        function shareKakao() {
            if (!Kakao.isInitialized()) {
                // ì¹´ì¹´ì˜¤ ì•±í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤
                showToast('ì¹´ì¹´ì˜¤ ê³µìœ  ì„¤ì • ì¤‘ì…ë‹ˆë‹¤');
                return;
            }
            
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: currentIssue.title,
                    description: `YES ${currentIssue.yesRatio}% vs NO ${currentIssue.noRatio}%`,
                    imageUrl: currentIssue.image_url || 'https://yegam.ai.kr/logo.png',
                    link: {
                        webUrl: window.location.href,
                        mobileWebUrl: window.location.href
                    }
                },
                buttons: [{
                    title: 'ì˜ˆì¸¡ ì°¸ì—¬í•˜ê¸°',
                    link: {
                        webUrl: window.location.href,
                        mobileWebUrl: window.location.href
                    }
                }]
            });
        }
        
        // ê³µìœ  - íŠ¸ìœ„í„°
        function shareTwitter() {
            const text = `${currentIssue.title}\n\nYES ${currentIssue.yesRatio}% vs NO ${currentIssue.noRatio}%\n\nì˜ˆê²œì—ì„œ ì˜ˆì¸¡ ì°¸ì—¬í•˜ê¸° ğŸ‘‡`;
            const url = window.location.href;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank', 'width=600,height=400');
        }
        
        // ê³µìœ  - ë§í¬ ë³µì‚¬
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                // í´ë°±
                const input = document.createElement('input');
                input.value = window.location.href;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
        
        // ìœ í‹¸
        function formatTime(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'ë°©ê¸ˆ ì „';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}ë¶„ ì „`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}ì‹œê°„ ì „`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)}ì¼ ì „`;
            return date.toLocaleDateString('ko-KR');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadIssue();
            lucide.createIcons();
            
            // Enterë¡œ ëŒ“ê¸€ ì‘ì„±
            document.getElementById('comment-input')?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    submitComment();
                }
            });
        });
    </script>
</body>
</html>
