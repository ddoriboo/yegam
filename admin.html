<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지 | 예겜</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        /* 드래그앤드롭 스타일 */
        .sortable-ghost {
            opacity: 0.4;
            background: #f3f4f6 !important;
            border: 2px dashed #3b82f6 !important;
        }
        
        .sortable-chosen {
            background: #eff6ff !important;
            border-color: #3b82f6 !important;
            transform: rotate(5deg);
        }
        
        .sortable-drag {
            background: #ffffff !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
            transform: rotate(5deg) scale(1.05);
            z-index: 9999 !important;
        }
        
        .sortable-fallback {
            background: #ffffff !important;
            border: 2px solid #3b82f6 !important;
            border-radius: 8px !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
            opacity: 1 !important;
        }
        
        .drag-handle:hover {
            background-color: #f3f4f6 !important;
        }
        
        .drag-handle:active {
            background-color: #e5e7eb !important;
        }
        
        .popular-issue-item:hover {
            transform: translateY(-1px);
        }
        
        .popular-issue-item.sortable-chosen {
            cursor: grabbing !important;
        }
        
        /* 드래그 중 커서 */
        .sortable-drag * {
            cursor: grabbing !important;
        }
        
        /* 선택 방지 */
        .select-none {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

    <div id="app-container" class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="bg-white/90 backdrop-blur-sm sticky top-0 border-b border-gray-200" style="z-index: 50000; overflow: visible !important;">
            <nav class="container mx-auto px-4 lg:px-8 py-3 flex justify-between items-center">
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="https://github.com/ddoriboo/yegam/raw/refs/heads/main/logo.png" alt="예겜 로고" class="h-8 w-auto">
                    <span class="text-xl font-bold tracking-tight text-gray-900 hidden sm:block">예겜</span>
                </a>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-6 text-sm font-medium text-gray-600">
                    <a href="issues.html" class="hover:text-gray-900 transition-colors">전체 이슈</a>
                    <button id="desktop-issue-request-btn" class="hidden hover:text-gray-900 transition-colors cursor-pointer bg-transparent border-none text-sm font-medium">이슈 신청</button>
                    <a href="discussions.html" class="hover:text-gray-900 transition-colors">분석방</a>
                    <a href="tier_guide.html" class="hover:text-gray-900 transition-colors">업적 안내</a>
                    <a href="mypage.html" class="hover:text-gray-900 transition-colors">내 정보</a>
                    <a href="admin.html" class="text-red-600 font-semibold">관리자</a>
                </div>
                
                <!-- Mobile & User Actions Container -->
                <div class="flex items-center space-x-1 sm:space-x-2">
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-btn" class="md:hidden p-2.5 rounded-md hover:bg-gray-100 transition-colors touch-manipulation">
                        <i data-lucide="menu" class="w-5 h-5 text-gray-600"></i>
                    </button>
                    
                    <!-- User Actions -->
                    <div id="header-user-actions" class="flex items-center space-x-1 sm:space-x-2">
                        <!-- This will be dynamically populated by js/app.js -->
                    </div>
                </div>
            </nav>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="hidden md:hidden bg-white/95 backdrop-blur-sm border-t border-gray-200">
                <div class="container mx-auto px-4 py-4 space-y-3">
                    <a href="issues.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="list" class="w-4 h-4 inline mr-2"></i>전체 이슈
                    </a>
                    <button id="mobile-issue-request-btn" class="hidden w-full text-left px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="plus-circle" class="w-4 h-4 inline mr-2"></i>이슈 신청
                    </button>
                    <a href="discussions.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="message-circle" class="w-4 h-4 inline mr-2"></i>분석방
                    </a>
                    <a href="tier_guide.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="award" class="w-4 h-4 inline mr-2"></i>업적 안내
                    </a>
                    <a href="mypage.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="user" class="w-4 h-4 inline mr-2"></i>내 정보
                    </a>
                    <a href="admin.html" class="block px-3 py-2 text-sm font-medium text-red-600 bg-red-50 rounded-md transition-colors">
                        <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>관리자
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 lg:px-8 py-12">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">관리자 페이지</h1>
                    <p class="text-gray-600">이슈와 댓글을 생성하고 관리할 수 있습니다.</p>
                </div>
                <button id="create-issue-btn" class="btn-primary">
                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                    새 이슈 생성
                </button>
            </div>
            
            <!-- 관리 탭 -->
            <div class="mb-8">
                <nav class="flex space-x-8 overflow-x-auto">
                    <button id="issues-tab" class="admin-tab active pb-4 border-b-2 border-blue-500 text-blue-600 font-medium whitespace-nowrap">
                        이슈 관리
                    </button>
                    <button id="issue-requests-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        이슈 신청 관리
                    </button>
                    <button id="results-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        결과 관리
                    </button>
                    <button id="comments-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        댓글 관리
                    </button>
                    <button id="scheduler-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        스케줄러 관리
                    </button>
                    <button id="popular-issues-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        인기 이슈 관리
                    </button>
                    <button id="discussions-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        분석방 관리
                    </button>
                    <button id="issue-requests-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        이슈 신청 관리
                    </button>
                </nav>
            </div>

            <!-- 새 이슈 생성 폼 -->
            <div id="create-issue-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">새 이슈 생성</h2>
                            <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <form id="create-issue-form" class="p-6 space-y-6">
                        <div>
                            <label for="issue-title" class="block text-sm font-medium text-gray-700 mb-2">이슈 제목</label>
                            <input type="text" id="issue-title" name="title" class="modern-input w-full" placeholder="예: 비트코인, 2025년 내 20만 달러 돌파할까?" required>
                        </div>
                        <div>
                            <label for="issue-category" class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                            <select id="issue-category" name="category" class="modern-select w-full" required>
                                <option value="">카테고리 선택</option>
                                <option value="정치">정치</option>
                                <option value="스포츠">스포츠</option>
                                <option value="경제">경제</option>
                                <option value="코인">코인</option>
                                <option value="테크">테크</option>
                                <option value="엔터">엔터</option>
                                <option value="날씨">날씨</option>
                                <option value="해외">해외</option>
                            </select>
                        </div>
                        <div>
                            <label for="issue-end-date" class="block text-sm font-medium text-gray-700 mb-2">마감일</label>
                            <input type="datetime-local" id="issue-end-date" name="endDate" class="modern-input w-full" required>
                        </div>
                        <div>
                            <label for="issue-description" class="block text-sm font-medium text-gray-700 mb-2">설명 (선택사항)</label>
                            <textarea id="issue-description" name="description" class="modern-input w-full" rows="3" placeholder="이슈에 대한 상세 설명"></textarea>
                        </div>
                        <div>
                            <label for="issue-image" class="block text-sm font-medium text-gray-700 mb-2">이미지 업로드 (선택사항)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <input type="file" id="issue-image" name="image" accept="image/*" class="hidden">
                                <input type="hidden" id="image-url" name="imageUrl" value="">
                                <div id="image-preview" class="hidden mb-4">
                                    <img id="preview-img" src="" alt="미리보기" class="mx-auto max-h-32 rounded">
                                    <button type="button" id="remove-image" class="mt-2 text-red-600 text-sm">이미지 제거</button>
                                </div>
                                <div id="upload-area" class="cursor-pointer" onclick="document.getElementById('issue-image').click()">
                                    <i data-lucide="upload" class="w-8 h-8 mx-auto text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-600">클릭하여 이미지를 업로드하거나 드래그 앤 드롭하세요</p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG (최대 5MB)</p>
                                </div>
                                <div id="upload-progress" class="hidden mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    <p class="text-xs text-gray-600 mt-1">업로드 중...</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="issue-yes-price" class="block text-sm font-medium text-gray-700 mb-2">초기 Yes 확률 (%)</label>
                            <input type="number" id="issue-yes-price" name="yesPrice" class="modern-input w-full" min="1" max="99" value="50" required>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="issue-popular" name="isPopular" class="mr-2">
                            <label for="issue-popular" class="text-sm text-gray-700">인기 이슈로 표시</label>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="btn-primary flex-1">이슈 생성</button>
                            <button type="button" id="cancel-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">취소</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 이슈 수정 모달 -->
            <div id="edit-issue-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">이슈 수정</h2>
                            <button id="close-edit-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <form id="edit-issue-form" class="p-6 space-y-6">
                        <input type="hidden" id="edit-issue-id" name="issueId">
                        <div>
                            <label for="edit-issue-title" class="block text-sm font-medium text-gray-700 mb-2">이슈 제목</label>
                            <input type="text" id="edit-issue-title" name="title" class="modern-input w-full" required>
                        </div>
                        <div>
                            <label for="edit-issue-category" class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                            <select id="edit-issue-category" name="category" class="modern-select w-full" required>
                                <option value="">카테고리 선택</option>
                                <option value="정치">정치</option>
                                <option value="스포츠">스포츠</option>
                                <option value="경제">경제</option>
                                <option value="코인">코인</option>
                                <option value="테크">테크</option>
                                <option value="엔터">엔터</option>
                                <option value="날씨">날씨</option>
                                <option value="해외">해외</option>
                            </select>
                        </div>
                        <div>
                            <label for="edit-issue-end-date" class="block text-sm font-medium text-gray-700 mb-2">마감일</label>
                            <input type="datetime-local" id="edit-issue-end-date" name="endDate" class="modern-input w-full" required>
                        </div>
                        <div>
                            <label for="edit-issue-description" class="block text-sm font-medium text-gray-700 mb-2">설명 (선택사항)</label>
                            <textarea id="edit-issue-description" name="description" class="modern-input w-full" rows="3"></textarea>
                        </div>
                        <div>
                            <label for="edit-issue-image" class="block text-sm font-medium text-gray-700 mb-2">이미지 업로드 (선택사항)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <input type="file" id="edit-issue-image" name="image" accept="image/*" class="hidden">
                                <input type="hidden" id="edit-image-url" name="imageUrl" value="">
                                <div id="edit-image-preview" class="hidden mb-4">
                                    <img id="edit-preview-img" src="" alt="미리보기" class="mx-auto max-h-32 rounded">
                                    <button type="button" id="edit-remove-image" class="mt-2 text-red-600 text-sm">이미지 제거</button>
                                </div>
                                <div id="edit-upload-area" class="cursor-pointer" onclick="document.getElementById('edit-issue-image').click()">
                                    <i data-lucide="upload" class="w-8 h-8 mx-auto text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-600">클릭하여 이미지를 업로드하거나 드래그 앤 드롭하세요</p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG (최대 5MB)</p>
                                </div>
                                <div id="edit-upload-progress" class="hidden mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    <p class="text-xs text-gray-600 mt-1">업로드 중...</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="edit-issue-yes-price" class="block text-sm font-medium text-gray-700 mb-2">초기 Yes 확률 (%)</label>
                            <input type="number" id="edit-issue-yes-price" name="yesPrice" class="modern-input w-full" min="1" max="99" required>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="edit-issue-popular" name="isPopular" class="mr-2">
                            <label for="edit-issue-popular" class="text-sm text-gray-700">인기 이슈로 표시</label>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="btn-primary flex-1">이슈 수정</button>
                            <button type="button" id="edit-cancel-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">취소</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 이슈 관리 테이블 -->
            <div id="issues-section" class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">이슈 관리</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이슈</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">마감시간</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yes 확률</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">참여량</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="issues-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 이슈 목록이 여기에 동적으로 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 이슈 신청 관리 섹션 -->
            <div id="issue-requests-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">이슈 신청 관리</h3>
                        <p class="text-sm text-gray-600 mt-1">사용자가 신청한 이슈를 검토하고 승인/거부할 수 있습니다</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <select id="request-status-filter" class="text-sm border border-gray-300 rounded-md px-3 py-1">
                            <option value="all">전체 상태</option>
                            <option value="pending" selected>대기 중</option>
                            <option value="approved">승인됨</option>
                            <option value="rejected">거부됨</option>
                        </select>
                        <button id="refresh-requests-btn" class="btn-secondary text-sm">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>
                            새로고침
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">신청 정보</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">신청자</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">마감일</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="issue-requests-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 이슈 신청 목록이 여기에 로드됩니다 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 이슈 신청이 없을 때 -->
                <div id="no-requests-message" class="hidden text-center py-12">
                    <i data-lucide="inbox" class="w-12 h-12 mx-auto text-gray-300 mb-4"></i>
                    <p class="text-gray-500">현재 이슈 신청이 없습니다.</p>
                </div>
                
                <!-- 로딩 상태 -->
                <div id="requests-loading" class="text-center py-12">
                    <i data-lucide="loader" class="w-6 h-6 animate-spin mx-auto mb-2 text-gray-400"></i>
                    <p class="text-gray-500">이슈 신청을 불러오는 중...</p>
                </div>
            </div>
            
            <!-- 이슈 신청 상세 모달 -->
            <div id="request-detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">이슈 신청 상세</h2>
                            <button id="close-request-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <div id="request-detail-content" class="p-6">
                        <!-- 상세 내용이 여기에 로드됩니다 -->
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button id="reject-request-btn" class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition-colors">
                            거부
                        </button>
                        <button id="approve-request-btn" class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 transition-colors">
                            승인 (1000 GAM 지급)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 결과 관리 섹션 -->
            <div id="results-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">이슈 결과 관리</h3>
                        <p class="text-sm text-gray-600 mt-1">마감된 이슈의 결과를 결정하고 보상을 지급합니다</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <select id="result-filter" class="text-sm border border-gray-300 rounded-md px-3 py-1">
                            <option value="closed">마감된 이슈</option>
                            <option value="pending">결과 대기</option>
                            <option value="resolved">결과 확정</option>
                            <option value="all">모든 이슈 (디버깅)</option>
                        </select>
                        <button id="refresh-results" class="text-sm text-gray-600 hover:text-gray-900">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>
                            새로고침
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이슈</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">마감일</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">참여 현황</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">결과</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="results-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 결과 관리 목록이 여기에 동적으로 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 이슈 결과 입력 모달 -->
            <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-lg w-full">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">이슈 결과 결정</h2>
                            <button id="close-result-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <form id="result-form" class="p-6 space-y-6">
                        <input type="hidden" id="result-issue-id" name="issueId">
                        
                        <!-- 이슈 정보 표시 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 id="result-issue-title" class="font-medium text-gray-900 mb-2"></h3>
                            <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <span class="font-medium">카테고리:</span>
                                    <span id="result-issue-category" class="ml-1"></span>
                                </div>
                                <div>
                                    <span class="font-medium">마감일:</span>
                                    <span id="result-issue-end-date" class="ml-1"></span>
                                </div>
                            </div>
                        </div>

                        <!-- 결과 선택 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">결과 선택</label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="relative">
                                    <input type="radio" name="result" value="Yes" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 text-center">
                                        <div class="text-2xl mb-2">✅</div>
                                        <div class="font-medium text-green-600">Yes</div>
                                        <div class="text-sm text-gray-500">이슈가 실현됨</div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="result" value="No" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-red-300 text-center">
                                        <div class="text-2xl mb-2">❌</div>
                                        <div class="font-medium text-red-600">No</div>
                                        <div class="text-sm text-gray-500">이슈가 실현되지 않음</div>
                                    </div>
                                </label>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mt-3">
                                <label class="relative">
                                    <input type="radio" name="result" value="Draw" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-yellow-300 text-center">
                                        <div class="text-2xl mb-2">⚖️</div>
                                        <div class="font-medium text-yellow-600">무승부</div>
                                        <div class="text-sm text-gray-500">판단 불가능</div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="result" value="Cancelled" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-400 text-center">
                                        <div class="text-2xl mb-2">🚫</div>
                                        <div class="font-medium text-gray-600">취소</div>
                                        <div class="text-sm text-gray-500">이슈 취소</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 결정 사유 -->
                        <div>
                            <label for="result-reason" class="block text-sm font-medium text-gray-700 mb-2">결정 사유</label>
                            <textarea id="result-reason" name="reason" class="modern-input w-full" rows="3" placeholder="결과를 결정한 이유를 입력하세요" required></textarea>
                        </div>

                        <!-- 버튼 -->
                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="btn-primary flex-1">결과 확정 및 보상 지급</button>
                            <button type="button" id="result-cancel-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">취소</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 댓글 관리 섹션 -->
            <div id="comments-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">댓글 관리</h3>
                    <div class="flex items-center space-x-4">
                        <select id="comment-filter" class="text-sm border border-gray-300 rounded-md px-3 py-1">
                            <option value="all">전체 댓글</option>
                            <option value="reported">신고된 댓글</option>
                            <option value="highlighted">강조된 댓글</option>
                        </select>
                        <button id="refresh-comments" class="text-sm text-gray-600 hover:text-gray-900">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>
                            새로고침
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">댓글</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성자</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이슈</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">좋아요</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성일</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="comments-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 댓글 목록이 여기에 동적으로 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
                <div id="comments-loading" class="hidden flex items-center justify-center py-8">
                    <i data-lucide="loader" class="w-6 h-6 animate-spin mr-2"></i>
                    <span class="text-gray-600">댓글을 불러오는 중...</span>
                </div>
                <div id="comments-empty" class="hidden text-center py-8 text-gray-500">
                    <i data-lucide="message-circle" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p>댓글이 없습니다.</p>
                </div>
            </div>
            
            <!-- 스케줄러 관리 섹션 -->
            <div id="scheduler-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">이슈 자동 마감 스케줄러</h3>
                        <p class="text-sm text-gray-600 mt-1">만료된 이슈를 자동으로 마감 처리하는 스케줄러를 관리합니다</p>
                    </div>
                </div>
                <div class="p-6 space-y-6">
                    <!-- 스케줄러 상태 -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-md font-medium text-gray-900 mb-3">스케줄러 상태</h4>
                        <div id="scheduler-status" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white p-3 rounded border">
                                <div class="text-sm text-gray-600">상태</div>
                                <div id="scheduler-running-status" class="text-lg font-semibold">
                                    <span class="inline-flex items-center">
                                        <i data-lucide="loader" class="w-4 h-4 animate-spin mr-2"></i>
                                        확인 중...
                                    </span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <div class="text-sm text-gray-600">다음 실행</div>
                                <div id="scheduler-next-run" class="text-lg font-semibold text-gray-900">-</div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <div class="text-sm text-gray-600">현재 시간</div>
                                <div id="scheduler-current-time" class="text-lg font-semibold text-gray-900">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 스케줄러 액션 -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-md font-medium text-gray-900 mb-3">수동 작업</h4>
                        <div class="flex space-x-3">
                            <button id="manual-check-btn" class="btn-primary">
                                <i data-lucide="play" class="w-4 h-4 mr-2"></i>
                                수동 마감 검사 실행
                            </button>
                            <button id="refresh-scheduler-status" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">
                                <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                                상태 새로고침
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">
                            수동 마감 검사를 실행하면 현재 시간 기준으로 만료된 모든 이슈를 즉시 마감 처리합니다.
                        </p>
                    </div>
                    
                    <!-- 스케줄러 로그 -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-md font-medium text-gray-900 mb-3">최근 활동</h4>
                        <div id="scheduler-logs" class="bg-white p-3 rounded border max-h-48 overflow-y-auto">
                            <div class="text-sm text-gray-500">로그가 없습니다.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 인기 이슈 관리 섹션 -->
            <div id="popular-issues-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">인기 이슈 관리</h3>
                            <p class="text-sm text-gray-600 mt-1">인기 이슈의 순서를 드래그 앤 드롭으로 조정할 수 있습니다</p>
                        </div>
                        <button id="refresh-popular-issues" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                            새로고침
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- 로딩 상태 -->
                    <div id="popular-issues-loading" class="text-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                        <p class="text-gray-500 mt-2">인기 이슈를 불러오는 중...</p>
                    </div>
                    
                    <!-- 인기 이슈 목록 -->
                    <div id="popular-issues-list" class="hidden">
                        <div class="mb-4">
                            <p class="text-sm text-gray-600">
                                <i class="inline-block w-4 h-4 mr-1" data-lucide="grip-vertical"></i>
                                드래그하여 순서를 변경하세요
                            </p>
                        </div>
                        
                        <div id="sortable-popular-issues" class="space-y-2">
                            <!-- 동적으로 생성되는 인기 이슈 목록 -->
                        </div>
                        
                        <div class="mt-6 flex justify-end">
                            <button id="save-popular-order" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                순서 저장
                            </button>
                        </div>
                    </div>
                    
                    <!-- 인기 이슈가 없을 때 -->
                    <div id="no-popular-issues" class="hidden text-center py-8">
                        <i data-lucide="star-off" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                        <p class="text-gray-500">인기 이슈가 없습니다.</p>
                        <p class="text-sm text-gray-400 mt-1">이슈 관리에서 이슈를 인기 이슈로 설정해보세요.</p>
                    </div>
                </div>
            </div>

            <!-- 분석방 관리 섹션 -->
            <div id="discussions-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">분석방 관리</h3>
                            <p class="text-sm text-gray-600 mt-1">분석방 게시글과 댓글을 관리할 수 있습니다</p>
                        </div>
                        <div class="flex space-x-2">
                            <button id="refresh-discussions" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                새로고침
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- 분석방 통계 -->
                    <div id="discussions-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="total-posts">-</div>
                            <div class="text-sm text-gray-600">전체 게시글</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="total-comments">-</div>
                            <div class="text-sm text-gray-600">전체 댓글</div>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600" id="today-posts">-</div>
                            <div class="text-sm text-gray-600">오늘 게시글</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600" id="notice-posts">-</div>
                            <div class="text-sm text-gray-600">공지글</div>
                        </div>
                    </div>
                    
                    <!-- 탭 네비게이션 -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="flex space-x-8">
                            <button id="posts-management-tab" class="discussion-tab active pb-4 border-b-2 border-blue-500 text-blue-600 font-medium">
                                게시글 관리
                            </button>
                            <button id="comments-management-tab" class="discussion-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                                댓글 관리
                            </button>
                        </nav>
                    </div>
                    
                    <!-- 게시글 관리 섹션 -->
                    <div id="posts-management" class="discussion-content">
                        <!-- 검색 및 필터 -->
                        <div class="mb-4 flex flex-col md:flex-row gap-4">
                            <div class="flex-1">
                                <input type="text" id="posts-search" placeholder="제목, 내용, 작성자로 검색..." 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex gap-2">
                                <select id="posts-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">전체 게시글</option>
                                    <option value="notice">공지글</option>
                                    <option value="pinned">고정글</option>
                                    <option value="reported">신고된 글</option>
                                </select>
                                <select id="posts-sort" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="latest">최신순</option>
                                    <option value="popular">인기순</option>
                                    <option value="discussed">댓글순</option>
                                    <option value="viewed">조회순</option>
                                </select>
                                <button id="search-posts" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                    검색
                                </button>
                            </div>
                        </div>
                        
                        <!-- 일괄 선택 및 삭제 컨트롤 -->
                        <div class="mb-4 flex items-center justify-between bg-gray-50 p-3 rounded-md">
                            <div class="flex items-center gap-3">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="select-all-posts" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <span class="text-sm font-medium text-gray-700">전체 선택</span>
                                </label>
                                <span id="selected-posts-count" class="text-sm text-gray-500">0개 선택됨</span>
                            </div>
                            <button id="bulk-delete-posts" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                선택된 항목 삭제
                            </button>
                        </div>
                        
                        <!-- 게시글 목록 -->
                        <div id="posts-loading" class="text-center py-8 hidden">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                            <p class="text-gray-500 mt-2">게시글을 불러오는 중...</p>
                        </div>
                        
                        <div id="posts-list" class="space-y-4">
                            <!-- 동적으로 생성되는 게시글 목록 -->
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="posts-pagination" class="mt-6 flex justify-center">
                            <!-- 동적으로 생성되는 페이지네이션 -->
                        </div>
                    </div>
                    
                    <!-- 댓글 관리 섹션 -->
                    <div id="comments-management" class="discussion-content hidden">
                        <!-- 검색 및 필터 -->
                        <div class="mb-4 flex flex-col md:flex-row gap-4">
                            <div class="flex-1">
                                <input type="text" id="comments-search" placeholder="댓글 내용, 작성자로 검색..." 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex gap-2">
                                <select id="comments-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">전체 댓글</option>
                                    <option value="reported">신고된 댓글</option>
                                    <option value="top_level">원댓글만</option>
                                    <option value="replies">대댓글만</option>
                                </select>
                                <button id="search-comments" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                    검색
                                </button>
                            </div>
                        </div>
                        
                        <!-- 일괄 선택 및 삭제 컨트롤 -->
                        <div class="mb-4 flex items-center justify-between bg-gray-50 p-3 rounded-md">
                            <div class="flex items-center gap-3">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="select-all-comments" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <span class="text-sm font-medium text-gray-700">전체 선택</span>
                                </label>
                                <span id="selected-comments-count" class="text-sm text-gray-500">0개 선택됨</span>
                            </div>
                            <button id="bulk-delete-comments" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                선택된 항목 삭제
                            </button>
                        </div>
                        
                        <!-- 댓글 목록 -->
                        <div id="comments-loading" class="text-center py-8 hidden">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                            <p class="text-gray-500 mt-2">댓글을 불러오는 중...</p>
                        </div>
                        
                        <div id="comments-list" class="space-y-4">
                            <!-- 동적으로 생성되는 댓글 목록 -->
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="comments-pagination" class="mt-6 flex justify-center">
                            <!-- 동적으로 생성되는 페이지네이션 -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
            <!-- 이슈 신청 관리 섹션 -->
            <div id="issue-requests-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">이슈 신청 관리</h3>
                            <p class="text-sm text-gray-600 mt-1">사용자와 AI가 신청한 이슈를 관리할 수 있습니다</p>
                        </div>
                        <div class="flex space-x-2">
                            <button id="refresh-issue-requests" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                새로고침
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- 이슈 신청 통계 -->
                    <div id="issue-requests-stats" class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600" id="pending-requests">-</div>
                            <div class="text-sm text-gray-600">대기 중</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="approved-requests">-</div>
                            <div class="text-sm text-gray-600">승인됨</div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-red-600" id="rejected-requests">-</div>
                            <div class="text-sm text-gray-600">거부됨</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600" id="ai-requests">-</div>
                            <div class="text-sm text-gray-600">AI 생성</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="user-requests">-</div>
                            <div class="text-sm text-gray-600">사용자 신청</div>
                        </div>
                    </div>
                    
                    <!-- 필터 및 검색 -->
                    <div class="mb-4 flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <input type="text" id="requests-search" placeholder="제목, 설명으로 검색..." 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex gap-2">
                            <select id="requests-status-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">전체 상태</option>
                                <option value="pending">대기 중</option>
                                <option value="approved">승인됨</option>
                                <option value="rejected">거부됨</option>
                            </select>
                            <select id="requests-type-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">전체 타입</option>
                                <option value="ai">AI 생성</option>
                                <option value="user">사용자 신청</option>
                            </select>
                            <button id="search-requests" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                검색
                            </button>
                        </div>
                    </div>
                    
                    <!-- 이슈 신청 목록 -->
                    <div id="requests-loading" class="text-center py-8 hidden">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                        <p class="text-gray-500 mt-2">이슈 신청을 불러오는 중...</p>
                    </div>
                    
                    <div id="requests-list" class="space-y-4">
                        <!-- 동적으로 생성되는 이슈 신청 목록 -->
                    </div>
                    
                    <!-- 페이지네이션 -->
                    <div id="requests-pagination" class="mt-6 flex justify-center">
                        <!-- 동적으로 생성되는 페이지네이션 -->
                    </div>
                </div>
            </div>

        <footer class="bg-gray-50 border-t border-gray-200">
            <div class="container mx-auto px-4 lg:px-8 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left space-y-4 md:space-y-0">
                    <div>
                        <a href="index.html" class="flex items-center justify-center md:justify-start space-x-2 mb-2">
                             <img src="https://github.com/ddoriboo/yegam/raw/refs/heads/main/logo.png" alt="예겜 Logo" class="h-6 w-auto">
                             <span class="font-semibold text-gray-900">예겜</span>
                        </a>
                        <p class="text-xs text-gray-500 max-w-md">본 서비스는 현금 베팅을 제공하지 않는 예측 정보 플랫폼이며, 사용되는 GAM은 환전 및 현금화가 불가능한 사이버 자산입니다.</p>
                    </div>
                    <div class="flex space-x-6 text-sm text-gray-500">
                        <a href="#" class="hover:text-gray-900 transition-colors">사이트 정보</a>
                        <a href="#" class="hover:text-gray-900 transition-colors">이용약관</a>
                        <a href="#" class="hover:text-gray-900 transition-colors">개인정보처리방침</a>
                    </div>
                </div>
                <div class="mt-8 border-t border-gray-200 pt-4 text-center text-xs text-gray-500">
                    &copy; 2025 예겜. All Rights Reserved.
                </div>
            </div>
        </footer>

    </div>

    <!-- 관리자 인증 스크립트 (app.js보다 먼저 실행) -->
    <script>
        // 관리자 페이지 플래그 설정 (app.js에서 확인)
        window.isAdminPage = true;
        window.adminAuthCompleted = false;
        
        // 관리자 인증 확인 함수
        async function checkAdminAuth() {
            const adminToken = localStorage.getItem('admin-token');
            
            if (!adminToken) {
                console.warn('⚠️ 관리자 토큰이 없습니다. 로그인 페이지로 이동합니다.');
                window.location.href = '/admin-login';
                return { success: false };
            }
            
            try {
                const response = await fetch('/api/admin-auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    console.warn('⚠️ 관리자 인증 실패:', data.message);
                    localStorage.removeItem('admin-token');
                    sessionStorage.removeItem('admin-user');
                    window.location.href = '/admin-login';
                    return { success: false };
                }
                
                // 관리자 정보를 세션에 저장
                sessionStorage.setItem('admin-user', JSON.stringify(data.admin));
                console.log('✅ 관리자 인증 성공:', data.admin.username);
                
                // 페이지에 관리자 정보 표시
                updateAdminHeader(data.admin);
                
                return { success: true, admin: data.admin };
                
            } catch (error) {
                console.error('❌ 관리자 인증 확인 중 오류:', error);
                localStorage.removeItem('admin-token');
                sessionStorage.removeItem('admin-user');
                window.location.href = '/admin-login';
                return { success: false };
            }
        }
        
        // 관리자 헤더 업데이트
        function updateAdminHeader(admin) {
            const userActionsContainer = document.getElementById('header-user-actions');
            if (userActionsContainer) {
                userActionsContainer.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center">
                                <i data-lucide="shield-check" class="w-4 h-4 text-white"></i>
                            </div>
                            <div class="hidden sm:block">
                                <div class="text-sm font-medium text-gray-900">${admin.username}</div>
                                <div class="text-xs text-red-600">${admin.role === 'super_admin' ? '슈퍼 관리자' : '관리자'}</div>
                            </div>
                        </div>
                        <button onclick="adminLogout()" class="text-gray-600 hover:text-red-600 transition-colors text-sm font-medium">
                            <i data-lucide="log-out" class="w-4 h-4 mr-1"></i>
                            로그아웃
                        </button>
                    </div>
                `;
                
                // Lucide 아이콘 재생성
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }
        
        // 관리자 로그아웃
        async function adminLogout() {
            const adminToken = localStorage.getItem('admin-token');
            
            if (adminToken) {
                try {
                    await fetch('/api/admin-auth/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`
                        }
                    });
                } catch (error) {
                    console.error('로그아웃 API 호출 실패:', error);
                }
            }
            
            // 로컬 토큰 및 세션 정리
            localStorage.removeItem('admin-token');
            sessionStorage.removeItem('admin-user');
            
            // 로그인 페이지로 이동
            window.location.href = '/admin-login';
        }
        
        // 전역 함수로 노출
        window.adminLogout = adminLogout;
        
        // 관리자 인증을 즉시 실행 (js/app.js보다 먼저)
        (async function() {
            console.log('🔐 관리자 페이지 접근 - 인증 확인 중...');
            
            const authResult = await checkAdminAuth();
            if (!authResult.success) {
                return; // 인증 실패 시 리다이렉트됨
            }
            
            console.log('✅ 관리자 인증 완료 - 사용자 정보 설정 중...');
            
            // 관리자 인증 완료 플래그 설정 (app.js에서 확인)
            window.adminAuthCompleted = true;
            window.adminAuthenticated = true;
            window.adminUser = authResult.admin;
            
            // 일반 사용자 인증 우회를 위한 가짜 사용자 설정
            window.currentUser = {
                id: authResult.admin.id,
                username: authResult.admin.username,
                email: authResult.admin.email,
                coins: 999999, // 관리자는 무제한
                isAdmin: true
            };
            
            // 일반 사용자 토큰도 설정 (app.js 호환을 위해)
            localStorage.setItem('yegame-token', localStorage.getItem('admin-token'));
            sessionStorage.setItem('yegame-user', JSON.stringify(window.currentUser));
            
            // app.js가 사용하는 전역 변수 미리 설정
            window.userToken = localStorage.getItem('admin-token');
            window.currentUser = window.currentUser; // 이미 설정됨
            
            console.log('🎯 관리자 모드 설정 완료 - app.js 로드 준비됨');
            
            // app.js 로드 후 헤더 강제 업데이트
            setTimeout(() => {
                if (typeof updateHeader === 'function') {
                    updateHeader(true);
                    console.log('🔄 관리자 헤더 강제 업데이트 완료');
                } else {
                    // updateHeader가 아직 정의되지 않았다면 조금 더 기다림
                    setTimeout(() => {
                        if (typeof updateHeader === 'function') {
                            updateHeader(true);
                            console.log('🔄 관리자 헤더 강제 업데이트 완료 (지연)');
                        }
                    }, 1000);
                }
            }, 500);
        })();
        
        // API 요청 시 관리자 토큰 자동 추가 함수
        window.adminFetch = async function(url, options = {}) {
            const adminToken = localStorage.getItem('admin-token');
            
            if (!adminToken) {
                console.error('❌ 관리자 토큰이 없습니다.');
                throw new Error('관리자 토큰이 없습니다.');
            }
            
            const headers = {
                'Authorization': `Bearer ${adminToken}`,
                ...options.headers
            };
            
            // FormData가 아닌 경우에만 Content-Type 설정
            if (!(options.body instanceof FormData) && !options.headers?.['Content-Type']) {
                headers['Content-Type'] = 'application/json';
            }
            
            console.log(`🔄 관리자 API 요청: ${options.method || 'GET'} ${url}`);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });
                
                console.log(`📡 응답 상태: ${response.status} ${response.statusText}`);
                
                // 401 Unauthorized - 토큰 만료 또는 무효
                if (response.status === 401) {
                    console.warn('⚠️ 관리자 인증 실패 - 토큰이 만료되었거나 무효합니다.');
                    
                    // 응답 내용을 확인해서 실제 인증 문제인지 확인
                    try {
                        const errorData = await response.json();
                        console.warn('401 응답 내용:', errorData);
                        
                        // 명확한 인증 오류인 경우에만 로그아웃
                        if (errorData.message && (
                            errorData.message.includes('토큰') || 
                            errorData.message.includes('인증') ||
                            errorData.message.includes('로그인')
                        )) {
                            console.warn('🚪 관리자 자동 로그아웃 실행');
                            adminLogout();
                        }
                    } catch (e) {
                        // JSON 파싱 실패해도 401이면 로그아웃
                        console.warn('🚪 관리자 자동 로그아웃 실행 (응답 파싱 실패)');
                        adminLogout();
                    }
                    
                    throw new Error('관리자 인증이 만료되었습니다.');
                }
                
                // 다른 오류들은 로그아웃하지 않고 그대로 반환
                if (!response.ok) {
                    console.warn(`⚠️ API 오류: ${response.status} - 로그아웃하지 않음`);
                }
                
                return response;
                
            } catch (error) {
                // 네트워크 오류 등
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    console.error('❌ 네트워크 연결 오류:', error.message);
                    throw new Error('서버에 연결할 수 없습니다. 네트워크를 확인해주세요.');
                }
                
                // 기타 오류는 그대로 전파
                throw error;
            }
        };
    </script>
    
    <!-- 분석방 관리 JavaScript -->
    <script>
        // 분석방 관리 전역 변수
        let discussionCurrentPage = 1;
        let discussionCurrentFilter = 'all';
        let discussionCurrentSort = 'latest';
        let discussionCurrentSearch = '';
        let discussionManagementType = 'posts'; // 'posts' or 'comments'
        let selectedPosts = new Set(); // 선택된 게시글 ID들
        let selectedComments = new Set(); // 선택된 댓글 ID들
        
        // 분석방 관리 초기화
        function initDiscussionManagement() {
            setupDiscussionTabs();
            setupDiscussionEventListeners();
        }
        
        // 분석방 섹션 표시
        function showDiscussionsSection() {
            // 모든 섹션 숨기기
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // 모든 탭 비활성화
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // 분석방 섹션 표시
            const section = document.getElementById('discussions-section');
            if (section) {
                section.classList.remove('hidden');
            }
            
            // 분석방 탭 활성화
            const tab = document.getElementById('discussions-tab');
            if (tab) {
                tab.classList.add('active', 'border-blue-500', 'text-blue-600');
                tab.classList.remove('border-transparent', 'text-gray-500');
            }
            
            // 새 이슈 생성 버튼 숨기기
            const createBtn = document.getElementById('create-issue-btn');
            if (createBtn) {
                createBtn.classList.add('hidden');
            }
        }
        
        // 분석방 탭 설정
        function setupDiscussionTabs() {
            // 메인 탭 (분석방 관리)
            const discussionsTab = document.getElementById('discussions-tab');
            if (discussionsTab) {
                discussionsTab.addEventListener('click', () => {
                    showDiscussionsSection();
                    loadDiscussionStats();
                    loadDiscussionPosts();
                });
            }
            
            // 하위 탭 (게시글/댓글 관리)
            const postsTab = document.getElementById('posts-management-tab');
            const commentsTab = document.getElementById('comments-management-tab');
            
            if (postsTab) {
                postsTab.addEventListener('click', () => {
                    discussionManagementType = 'posts';
                    setActiveDiscussionTab('posts-management-tab');
                    showDiscussionContent('posts-management');
                    loadDiscussionPosts();
                });
            }
            
            if (commentsTab) {
                commentsTab.addEventListener('click', () => {
                    discussionManagementType = 'comments';
                    setActiveDiscussionTab('comments-management-tab');
                    showDiscussionContent('comments-management');
                    loadDiscussionComments();
                });
            }
        }
        
        // 분석방 이벤트 리스너 설정
        function setupDiscussionEventListeners() {
            // 새로고침 버튼
            const refreshBtn = document.getElementById('refresh-discussions');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    loadDiscussionStats();
                    if (discussionManagementType === 'posts') {
                        loadDiscussionPosts();
                    } else {
                        loadDiscussionComments();
                    }
                });
            }
            
            // 검색 버튼들
            const searchPostsBtn = document.getElementById('search-posts');
            const searchCommentsBtn = document.getElementById('search-comments');
            
            if (searchPostsBtn) {
                searchPostsBtn.addEventListener('click', () => {
                    discussionCurrentPage = 1;
                    discussionCurrentSearch = document.getElementById('posts-search').value;
                    discussionCurrentFilter = document.getElementById('posts-filter').value;
                    discussionCurrentSort = document.getElementById('posts-sort').value;
                    loadDiscussionPosts();
                });
            }
            
            if (searchCommentsBtn) {
                searchCommentsBtn.addEventListener('click', () => {
                    discussionCurrentPage = 1;
                    discussionCurrentSearch = document.getElementById('comments-search').value;
                    discussionCurrentFilter = document.getElementById('comments-filter').value;
                    loadDiscussionComments();
                });
            }
            
            // 전체 선택 체크박스
            const selectAllPostsBtn = document.getElementById('select-all-posts');
            const selectAllCommentsBtn = document.getElementById('select-all-comments');
            
            if (selectAllPostsBtn) {
                selectAllPostsBtn.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    document.querySelectorAll('.post-checkbox').forEach(checkbox => {
                        checkbox.checked = isChecked;
                        const postId = parseInt(checkbox.value);
                        if (isChecked) {
                            selectedPosts.add(postId);
                        } else {
                            selectedPosts.delete(postId);
                        }
                    });
                    updateSelectedCount('posts');
                });
            }
            
            if (selectAllCommentsBtn) {
                selectAllCommentsBtn.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    document.querySelectorAll('.comment-checkbox').forEach(checkbox => {
                        checkbox.checked = isChecked;
                        const commentId = parseInt(checkbox.value);
                        if (isChecked) {
                            selectedComments.add(commentId);
                        } else {
                            selectedComments.delete(commentId);
                        }
                    });
                    updateSelectedCount('comments');
                });
            }
            
            // 일괄 삭제 버튼
            const bulkDeletePostsBtn = document.getElementById('bulk-delete-posts');
            const bulkDeleteCommentsBtn = document.getElementById('bulk-delete-comments');
            
            if (bulkDeletePostsBtn) {
                bulkDeletePostsBtn.addEventListener('click', () => {
                    bulkDeletePosts();
                });
            }
            
            if (bulkDeleteCommentsBtn) {
                bulkDeleteCommentsBtn.addEventListener('click', () => {
                    bulkDeleteComments();
                });
            }
        }
        
        // 분석방 통계 로드
        async function loadDiscussionStats() {
            try {
                const response = await window.adminFetch('/api/admin/discussions/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('total-posts').textContent = stats.totalPosts.toLocaleString();
                    document.getElementById('total-comments').textContent = stats.totalComments.toLocaleString();
                    document.getElementById('today-posts').textContent = stats.todayPosts.toLocaleString();
                    document.getElementById('notice-posts').textContent = stats.noticePosts.toLocaleString();
                }
            } catch (error) {
                console.error('분석방 통계 로드 오류:', error);
            }
        }
        
        // 분석방 게시글 로드
        async function loadDiscussionPosts() {
            const loadingEl = document.getElementById('posts-loading');
            const listEl = document.getElementById('posts-list');
            
            if (loadingEl) loadingEl.classList.remove('hidden');
            if (listEl) listEl.innerHTML = '';
            
            try {
                const params = new URLSearchParams({
                    page: discussionCurrentPage,
                    limit: 20,
                    search: discussionCurrentSearch,
                    filter: discussionCurrentFilter,
                    sort: discussionCurrentSort
                });
                
                const response = await window.adminFetch(`/api/admin/discussions/posts?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    renderDiscussionPosts(data.data.posts);
                    renderDiscussionPagination(data.data.pagination, 'posts');
                }
            } catch (error) {
                console.error('분석방 게시글 로드 오류:', error);
                if (listEl) {
                    listEl.innerHTML = '<div class="text-center py-8 text-red-600">게시글을 불러오는 중 오류가 발생했습니다.</div>';
                }
            } finally {
                if (loadingEl) loadingEl.classList.add('hidden');
            }
        }
        
        // 분석방 댓글 로드
        async function loadDiscussionComments() {
            const loadingEl = document.getElementById('comments-loading');
            const listEl = document.getElementById('comments-list');
            
            if (loadingEl) loadingEl.classList.remove('hidden');
            if (listEl) listEl.innerHTML = '';
            
            try {
                const params = new URLSearchParams({
                    page: discussionCurrentPage,
                    limit: 50,
                    search: discussionCurrentSearch,
                    filter: discussionCurrentFilter
                });
                
                const response = await window.adminFetch(`/api/admin/discussions/comments?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    renderDiscussionComments(data.data.comments);
                    renderDiscussionPagination(data.data.pagination, 'comments');
                }
            } catch (error) {
                console.error('분석방 댓글 로드 오류:', error);
                if (listEl) {
                    listEl.innerHTML = '<div class="text-center py-8 text-red-600">댓글을 불러오는 중 오류가 발생했습니다.</div>';
                }
            } finally {
                if (loadingEl) loadingEl.classList.add('hidden');
            }
        }
        
        // 분석방 게시글 렌더링
        function renderDiscussionPosts(posts) {
            const listEl = document.getElementById('posts-list');
            if (!listEl) return;
            
            // 선택 상태 초기화
            selectedPosts.clear();
            updateSelectedCount('posts');
            
            // 전체 선택 체크박스 해제
            const selectAllCheckbox = document.getElementById('select-all-posts');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
            
            if (posts.length === 0) {
                listEl.innerHTML = '<div class="text-center py-8 text-gray-500">게시글이 없습니다.</div>';
                return;
            }
            
            listEl.innerHTML = posts.map(post => `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <div class="flex items-center pt-1">
                            <input type="checkbox" class="post-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" 
                                value="${post.id}" onchange="handlePostCheckboxChange(${post.id})">
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h4 class="font-medium text-gray-900">${post.title}</h4>
                                ${post.is_notice ? '<span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded">공지</span>' : ''}
                                ${post.is_pinned ? '<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">고정</span>' : ''}
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${post.content_preview}...</p>
                            <div class="flex items-center gap-4 text-xs text-gray-500">
                                <span>작성자: ${post.author_name}</span>
                                <span>카테고리: ${post.category_name}</span>
                                <span>좋아요: ${post.like_count}</span>
                                <span>댓글: ${post.comment_count}</span>
                                <span>조회: ${post.view_count}</span>
                                <span>${new Date(post.created_at).toLocaleString('ko-KR')}</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleDiscussionPostNotice(${post.id}, ${post.is_notice}, ${post.is_pinned})" 
                                class="px-3 py-1 text-xs ${post.is_notice ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'} rounded hover:bg-opacity-80">
                                ${post.is_notice ? '공지해제' : '공지설정'}
                            </button>
                            <button onclick="deleteDiscussionPost(${post.id}, '${post.title.replace(/'/g, '\\\'')}')" 
                                class="px-3 py-1 text-xs bg-red-100 text-red-800 rounded hover:bg-red-200">
                                삭제
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // 분석방 댓글 렌더링
        function renderDiscussionComments(comments) {
            const listEl = document.getElementById('comments-list');
            if (!listEl) return;
            
            // 선택 상태 초기화
            selectedComments.clear();
            updateSelectedCount('comments');
            
            // 전체 선택 체크박스 해제
            const selectAllCheckbox = document.getElementById('select-all-comments');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
            
            if (comments.length === 0) {
                listEl.innerHTML = '<div class="text-center py-8 text-gray-500">댓글이 없습니다.</div>';
                return;
            }
            
            listEl.innerHTML = comments.map(comment => `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <div class="flex items-center pt-1">
                            <input type="checkbox" class="comment-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" 
                                value="${comment.id}" onchange="handleCommentCheckboxChange(${comment.id})">
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="font-medium text-gray-900">${comment.author_name}</span>
                                <span class="text-sm text-gray-500">→ ${comment.post_title}</span>
                                ${comment.parent_id ? `<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">답글</span>` : ''}
                            </div>
                            <p class="text-sm text-gray-700 mb-2">${comment.content}</p>
                            <div class="flex items-center gap-4 text-xs text-gray-500">
                                <span>좋아요: ${comment.like_count}</span>
                                <span>${new Date(comment.created_at).toLocaleString('ko-KR')}</span>
                                ${comment.parent_author_name ? `<span>답글 대상: ${comment.parent_author_name}</span>` : ''}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="deleteDiscussionComment(${comment.id}, ${comment.post_id})" 
                                class="px-3 py-1 text-xs bg-red-100 text-red-800 rounded hover:bg-red-200">
                                삭제
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // 분석방 페이지네이션 렌더링
        function renderDiscussionPagination(pagination, type) {
            const paginationEl = document.getElementById(`${type}-pagination`);
            if (!paginationEl) return;
            
            const { page, pages, total } = pagination;
            
            if (pages <= 1) {
                paginationEl.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // 이전 페이지
            if (page > 1) {
                paginationHTML += `<button onclick="changeDiscussionPage(${page - 1}, '${type}')" class="px-3 py-2 text-sm bg-white border border-gray-300 text-gray-500 hover:bg-gray-50 rounded-l-md">이전</button>`;
            }
            
            // 페이지 번호들
            const startPage = Math.max(1, page - 2);
            const endPage = Math.min(pages, page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === page;
                paginationHTML += `<button onclick="changeDiscussionPage(${i}, '${type}')" class="px-3 py-2 text-sm ${isActive ? 'bg-blue-600 text-white' : 'bg-white border border-gray-300 text-gray-500 hover:bg-gray-50'}">${i}</button>`;
            }
            
            // 다음 페이지
            if (page < pages) {
                paginationHTML += `<button onclick="changeDiscussionPage(${page + 1}, '${type}')" class="px-3 py-2 text-sm bg-white border border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md">다음</button>`;
            }
            
            paginationEl.innerHTML = `<div class="flex">${paginationHTML}</div>`;
        }
        
        // 페이지 변경
        function changeDiscussionPage(page, type) {
            discussionCurrentPage = page;
            if (type === 'posts') {
                loadDiscussionPosts();
            } else {
                loadDiscussionComments();
            }
        }
        
        // 게시글 공지/고정 토글
        async function toggleDiscussionPostNotice(postId, currentNotice, currentPinned) {
            const newNotice = !currentNotice;
            
            try {
                const response = await window.adminFetch(`/api/admin/discussions/posts/${postId}/toggle-notice`, {
                    method: 'POST',
                    body: JSON.stringify({
                        is_notice: newNotice,
                        is_pinned: currentPinned
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    loadDiscussionPosts();
                    loadDiscussionStats();
                } else {
                    alert('설정 변경에 실패했습니다: ' + data.message);
                }
            } catch (error) {
                console.error('공지 설정 오류:', error);
                alert('설정 변경 중 오류가 발생했습니다.');
            }
        }
        
        // 게시글 삭제
        async function deleteDiscussionPost(postId, title) {
            if (!confirm(`"${title}" 게시글을 정말 삭제하시겠습니까?`)) {
                return;
            }
            
            const reason = prompt('삭제 사유를 입력하세요 (선택사항):');
            
            try {
                const response = await window.adminFetch(`/api/admin/discussions/posts/${postId}`, {
                    method: 'DELETE',
                    body: JSON.stringify({ reason })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('게시글이 삭제되었습니다.');
                    loadDiscussionPosts();
                    loadDiscussionStats();
                } else {
                    alert('게시글 삭제에 실패했습니다: ' + data.message);
                }
            } catch (error) {
                console.error('게시글 삭제 오류:', error);
                alert('게시글 삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 댓글 삭제
        async function deleteDiscussionComment(commentId, postId) {
            if (!confirm('이 댓글을 정말 삭제하시겠습니까?')) {
                return;
            }
            
            const reason = prompt('삭제 사유를 입력하세요 (선택사항):');
            
            try {
                const response = await window.adminFetch(`/api/admin/discussions/comments/${commentId}`, {
                    method: 'DELETE',
                    body: JSON.stringify({ reason })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('댓글이 삭제되었습니다.');
                    loadDiscussionComments();
                    loadDiscussionStats();
                } else {
                    alert('댓글 삭제에 실패했습니다: ' + data.message);
                }
            } catch (error) {
                console.error('댓글 삭제 오류:', error);
                alert('댓글 삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 분석방 탭 활성화
        function setActiveDiscussionTab(activeTabId) {
            const tabs = document.querySelectorAll('.discussion-tab');
            tabs.forEach(tab => {
                if (tab.id === activeTabId) {
                    tab.classList.add('active', 'border-blue-500', 'text-blue-600');
                    tab.classList.remove('border-transparent', 'text-gray-500');
                } else {
                    tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    tab.classList.add('border-transparent', 'text-gray-500');
                }
            });
        }
        
        // 분석방 콘텐츠 표시
        function showDiscussionContent(activeContentId) {
            const contents = document.querySelectorAll('.discussion-content');
            contents.forEach(content => {
                if (content.id === activeContentId) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        }
        
        // 페이지 로드 시 분석방 관리 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initDiscussionManagement();
        });
        
        // 체크박스 이벤트 핸들러
        function handlePostCheckboxChange(postId) {
            const checkbox = document.querySelector(`.post-checkbox[value="${postId}"]`);
            if (checkbox.checked) {
                selectedPosts.add(postId);
            } else {
                selectedPosts.delete(postId);
            }
            updateSelectedCount('posts');
            updateSelectAllCheckbox('posts');
        }
        
        function handleCommentCheckboxChange(commentId) {
            const checkbox = document.querySelector(`.comment-checkbox[value="${commentId}"]`);
            if (checkbox.checked) {
                selectedComments.add(commentId);
            } else {
                selectedComments.delete(commentId);
            }
            updateSelectedCount('comments');
            updateSelectAllCheckbox('comments');
        }
        
        // 선택된 항목 수 업데이트
        function updateSelectedCount(type) {
            const countEl = document.getElementById(`selected-${type}-count`);
            const deleteBtn = document.getElementById(`bulk-delete-${type}`);
            
            const selectedCount = type === 'posts' ? selectedPosts.size : selectedComments.size;
            
            if (countEl) {
                countEl.textContent = `${selectedCount}개 선택됨`;
            }
            
            if (deleteBtn) {
                deleteBtn.disabled = selectedCount === 0;
            }
        }
        
        // 전체 선택 체크박스 상태 업데이트
        function updateSelectAllCheckbox(type) {
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            const checkboxes = document.querySelectorAll(`.${type.slice(0, -1)}-checkbox`);
            
            if (selectAllCheckbox && checkboxes.length > 0) {
                const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                
                if (checkedCount === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                } else if (checkedCount === checkboxes.length) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                }
            }
        }
        
        // 일괄 삭제 함수들
        async function bulkDeletePosts() {
            if (selectedPosts.size === 0) {
                alert('삭제할 게시글을 선택해주세요.');
                return;
            }
            
            const postIds = Array.from(selectedPosts);
            const confirmMessage = `선택된 ${postIds.length}개의 게시글을 정말 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const reason = prompt('삭제 사유를 입력하세요 (선택사항):');
            
            try {
                const response = await window.adminFetch('/api/admin/discussions/posts/bulk', {
                    method: 'DELETE',
                    body: JSON.stringify({ 
                        postIds: postIds,
                        reason: reason
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`${data.deletedCount}개의 게시글이 성공적으로 삭제되었습니다.`);
                    selectedPosts.clear();
                    loadDiscussionPosts();
                    loadDiscussionStats();
                } else {
                    alert('일괄 삭제에 실패했습니다: ' + data.message);
                }
            } catch (error) {
                console.error('게시글 일괄 삭제 오류:', error);
                alert('게시글 일괄 삭제 중 오류가 발생했습니다.');
            }
        }
        
        async function bulkDeleteComments() {
            if (selectedComments.size === 0) {
                alert('삭제할 댓글을 선택해주세요.');
                return;
            }
            
            const commentIds = Array.from(selectedComments);
            const confirmMessage = `선택된 ${commentIds.length}개의 댓글을 정말 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const reason = prompt('삭제 사유를 입력하세요 (선택사항):');
            
            try {
                const response = await window.adminFetch('/api/admin/discussions/comments/bulk', {
                    method: 'DELETE',
                    body: JSON.stringify({ 
                        commentIds: commentIds,
                        reason: reason
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`${data.deletedCount}개의 댓글이 성공적으로 삭제되었습니다.`);
                    selectedComments.clear();
                    loadDiscussionComments();
                    loadDiscussionStats();
                } else {
                    alert('일괄 삭제에 실패했습니다: ' + data.message);
                }
            } catch (error) {
                console.error('댓글 일괄 삭제 오류:', error);
                alert('댓글 일괄 삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 전역 함수들 노출
        window.toggleDiscussionPostNotice = toggleDiscussionPostNotice;
        window.deleteDiscussionPost = deleteDiscussionPost;
        window.deleteDiscussionComment = deleteDiscussionComment;
        window.changeDiscussionPage = changeDiscussionPage;
        window.handlePostCheckboxChange = handlePostCheckboxChange;
        window.handleCommentCheckboxChange = handleCommentCheckboxChange;
    </script>
    
    <!-- 이슈 신청 관리 JavaScript -->
    <script>
        // 이슈 신청 관리 전역 변수
        let requestsCurrentPage = 1;
        let requestsCurrentStatusFilter = 'all';
        let requestsCurrentTypeFilter = 'all';
        let requestsCurrentSearch = '';
        
        // 이슈 신청 관리 초기화
        function initIssueRequestsManagement() {
            setupIssueRequestsTabs();
            setupIssueRequestsEventListeners();
        }
        
        // 이슈 신청 섹션 표시
        function showIssueRequestsSection() {
            // 모든 섹션 숨기기
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // 모든 탭 비활성화
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // 이슈 신청 섹션 표시
            const section = document.getElementById('issue-requests-section');
            if (section) {
                section.classList.remove('hidden');
            }
            
            // 이슈 신청 탭 활성화
            const tab = document.getElementById('issue-requests-tab');
            if (tab) {
                tab.classList.add('active', 'border-blue-500', 'text-blue-600');
                tab.classList.remove('border-transparent', 'text-gray-500');
            }
            
            // 새 이슈 생성 버튼 숨기기
            const createBtn = document.getElementById('create-issue-btn');
            if (createBtn) {
                createBtn.classList.add('hidden');
            }
        }
        
        // 이슈 신청 탭 설정
        function setupIssueRequestsTabs() {
            const issueRequestsTab = document.getElementById('issue-requests-tab');
            if (issueRequestsTab) {
                issueRequestsTab.addEventListener('click', () => {
                    showIssueRequestsSection();
                    loadIssueRequestsStats();
                    loadIssueRequests();
                });
            }
        }
        
        // 이슈 신청 이벤트 리스너 설정
        function setupIssueRequestsEventListeners() {
            // 새로고침 버튼
            const refreshBtn = document.getElementById('refresh-issue-requests');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    loadIssueRequestsStats();
                    loadIssueRequests();
                });
            }
            
            // 검색 버튼
            const searchBtn = document.getElementById('search-requests');
            if (searchBtn) {
                searchBtn.addEventListener('click', () => {
                    requestsCurrentPage = 1;
                    requestsCurrentSearch = document.getElementById('requests-search').value;
                    requestsCurrentStatusFilter = document.getElementById('requests-status-filter').value;
                    requestsCurrentTypeFilter = document.getElementById('requests-type-filter').value;
                    loadIssueRequests();
                });
            }
        }
        
        // 이슈 신청 통계 로드
        async function loadIssueRequestsStats() {
            try {
                const response = await window.adminFetch('/api/issue-requests/admin/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('pending-requests').textContent = stats.pending.toLocaleString();
                    document.getElementById('approved-requests').textContent = stats.approved.toLocaleString();
                    document.getElementById('rejected-requests').textContent = stats.rejected.toLocaleString();
                    document.getElementById('ai-requests').textContent = stats.aiGenerated.toLocaleString();
                    document.getElementById('user-requests').textContent = stats.userGenerated.toLocaleString();
                }
            } catch (error) {
                console.error('이슈 신청 통계 로드 오류:', error);
            }
        }
        
        // 이슈 신청 목록 로드
        async function loadIssueRequests() {
            const loadingEl = document.getElementById('requests-loading');
            const listEl = document.getElementById('requests-list');
            
            if (loadingEl) loadingEl.classList.remove('hidden');
            if (listEl) listEl.innerHTML = '';
            
            try {
                const params = new URLSearchParams({
                    page: requestsCurrentPage,
                    limit: 20,
                    search: requestsCurrentSearch,
                    status: requestsCurrentStatusFilter,
                    type: requestsCurrentTypeFilter
                });
                
                const response = await window.adminFetch(`/api/issue-requests/admin/all?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    renderIssueRequests(data.requests);
                    renderIssueRequestsPagination(data.pagination);
                }
            } catch (error) {
                console.error('이슈 신청 목록 로드 오류:', error);
                if (listEl) {
                    listEl.innerHTML = '<div class="text-center py-8 text-red-600">이슈 신청을 불러오는 중 오류가 발생했습니다.</div>';
                }
            } finally {
                if (loadingEl) loadingEl.classList.add('hidden');
            }
        }
        
        // 이슈 신청 목록 렌더링
        function renderIssueRequests(requests) {
            const listEl = document.getElementById('requests-list');
            if (!listEl) return;
            
            if (requests.length === 0) {
                listEl.innerHTML = '<div class="text-center py-8 text-gray-500">이슈 신청이 없습니다.</div>';
                return;
            }
            
            listEl.innerHTML = requests.map(request => `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-start gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h4 class="font-medium text-gray-900">${request.title}</h4>
                                ${request.is_ai_generated ? 
                                    `<span class="px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full">🤖 AI 생성</span>` : 
                                    `<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">👤 사용자</span>`
                                }
                                ${getStatusBadge(request.status)}
                                <span class="px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded-full">${request.category}</span>
                            </div>
                            
                            <div class="text-sm text-gray-600 mb-3 line-clamp-2">
                                ${request.description.length > 200 ? request.description.substring(0, 200) + '...' : request.description}
                            </div>
                            
                            <div class="flex items-center gap-4 text-xs text-gray-500">
                                <span>신청자: ${request.username}</span>
                                <span>신청일: ${new Date(request.created_at).toLocaleString('ko-KR')}</span>
                                <span>마감일: ${new Date(request.deadline).toLocaleString('ko-KR')}</span>
                                ${request.is_ai_generated ? `<span>에이전트: ${request.agent_id}</span>` : ''}
                            </div>
                            
                            ${request.admin_comments ? `
                                <div class="mt-2 p-2 bg-gray-50 rounded text-sm">
                                    <strong>관리자 의견:</strong> ${request.admin_comments}
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="flex flex-col gap-2">
                            ${request.status === 'pending' ? `
                                <button onclick="approveIssueRequest(${request.id}, '${request.title.replace(/'/g, '\\\'')}')" 
                                    class="px-3 py-1 text-xs bg-green-100 text-green-800 rounded hover:bg-green-200">
                                    승인
                                </button>
                                <button onclick="rejectIssueRequest(${request.id}, '${request.title.replace(/'/g, '\\\'')}')" 
                                    class="px-3 py-1 text-xs bg-red-100 text-red-800 rounded hover:bg-red-200">
                                    거부
                                </button>
                            ` : ''}
                            <button onclick="viewIssueRequestDetails(${request.id})" 
                                class="px-3 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200">
                                상세보기
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // 상태 배지 생성
        function getStatusBadge(status) {
            const statusConfig = {
                'pending': { class: 'bg-yellow-100 text-yellow-800', text: '대기 중' },
                'approved': { class: 'bg-green-100 text-green-800', text: '승인됨' },
                'rejected': { class: 'bg-red-100 text-red-800', text: '거부됨' }
            };
            
            const config = statusConfig[status] || statusConfig.pending;
            return `<span class="px-2 py-1 text-xs ${config.class} rounded-full">${config.text}</span>`;
        }
        
        // 이슈 신청 승인
        async function approveIssueRequest(requestId, title) {
            const comments = prompt(`"${title}" 이슈 신청을 승인하시겠습니까?\n\n관리자 의견 (선택사항):`);
            
            if (comments === null) return; // 취소
            
            try {
                const response = await window.adminFetch(`/api/issue-requests/${requestId}/approve`, {
                    method: 'PUT',
                    body: JSON.stringify({ adminComments: comments })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('이슈 신청이 승인되었습니다.');
                    loadIssueRequests();
                    loadIssueRequestsStats();
                } else {
                    alert('승인 실패: ' + data.message);
                }
            } catch (error) {
                console.error('이슈 신청 승인 오류:', error);
                alert('승인 처리 중 오류가 발생했습니다.');
            }
        }
        
        // 이슈 신청 거부
        async function rejectIssueRequest(requestId, title) {
            const comments = prompt(`"${title}" 이슈 신청을 거부하시겠습니까?\n\n거부 사유를 입력하세요:`);
            
            if (!comments || comments.trim() === '') {
                alert('거부 사유를 입력해주세요.');
                return;
            }
            
            try {
                const response = await window.adminFetch(`/api/issue-requests/${requestId}/reject`, {
                    method: 'PUT',
                    body: JSON.stringify({ adminComments: comments })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('이슈 신청이 거부되었습니다.');
                    loadIssueRequests();
                    loadIssueRequestsStats();
                } else {
                    alert('거부 실패: ' + data.message);
                }
            } catch (error) {
                console.error('이슈 신청 거부 오류:', error);
                alert('거부 처리 중 오류가 발생했습니다.');
            }
        }
        
        // 이슈 신청 상세 보기
        function viewIssueRequestDetails(requestId) {
            // TODO: 모달로 상세 정보 표시
            alert(`이슈 신청 상세 정보 (ID: ${requestId})\n\n이 기능은 곧 구현될 예정입니다.`);
        }
        
        // 페이지네이션 렌더링
        function renderIssueRequestsPagination(pagination) {
            const paginationEl = document.getElementById('requests-pagination');
            if (!paginationEl || !pagination) return;
            
            const { page, pages, total } = pagination;
            
            if (pages <= 1) {
                paginationEl.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // 이전 페이지
            if (page > 1) {
                paginationHTML += `<button onclick="changeIssueRequestsPage(${page - 1})" class="px-3 py-2 text-sm bg-white border border-gray-300 text-gray-500 hover:bg-gray-50 rounded-l-md">이전</button>`;
            }
            
            // 페이지 번호들
            const startPage = Math.max(1, page - 2);
            const endPage = Math.min(pages, page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === page;
                paginationHTML += `<button onclick="changeIssueRequestsPage(${i})" class="px-3 py-2 text-sm ${isActive ? 'bg-blue-600 text-white' : 'bg-white border border-gray-300 text-gray-500 hover:bg-gray-50'}">${i}</button>`;
            }
            
            // 다음 페이지
            if (page < pages) {
                paginationHTML += `<button onclick="changeIssueRequestsPage(${page + 1})" class="px-3 py-2 text-sm bg-white border border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md">다음</button>`;
            }
            
            paginationEl.innerHTML = `<div class="flex">${paginationHTML}</div>`;
        }
        
        // 페이지 변경
        function changeIssueRequestsPage(page) {
            requestsCurrentPage = page;
            loadIssueRequests();
        }
        
        // 페이지 로드 시 이슈 신청 관리 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initIssueRequestsManagement();
        });
        
        // 전역 함수들 노출
        window.approveIssueRequest = approveIssueRequest;
        window.rejectIssueRequest = rejectIssueRequest;
        window.viewIssueRequestDetails = viewIssueRequestDetails;
        window.changeIssueRequestsPage = changeIssueRequestsPage;
    </script>
    
    <script src="utils/tierSystem.js"></script>
    <script src="js/animations/coin-explosion.js"></script>
    <script src="js/ui/betting-modal.js"></script>
    <script src="js/ui/issue-request-modal.js"></script>
    <script src="js/ui/premium-notifications.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>