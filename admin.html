<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지 | 예겜</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

    <div id="app-container" class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="bg-white/90 backdrop-blur-sm sticky top-0 z-50 border-b border-gray-200">
            <nav class="container mx-auto px-4 lg:px-8 py-3 flex justify-between items-center">
                <a href="index.html" class="flex items-center space-x-3">
                    <img src="https://github.com/ddoriboo/yegam/raw/refs/heads/main/logo.png" alt="예겜 Logo" class="h-8 w-auto">
                    <span class="text-xl font-bold tracking-tight text-gray-900">예겜</span>
                </a>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-6 text-sm font-medium text-gray-600">
                    <a href="issues.html" class="hover:text-gray-900 transition-colors">전체 이슈</a>
                    <a href="tier_guide.html" class="hover:text-gray-900 transition-colors">업적 안내</a>
                    <a href="mypage.html" class="hover:text-gray-900 transition-colors">내 정보</a>
                    <a href="admin.html" class="text-red-600 font-semibold">관리자</a>
                </div>
                
                <!-- Mobile & User Actions Container -->
                <div class="flex items-center space-x-2">
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-btn" class="md:hidden p-2 rounded-md hover:bg-gray-100 transition-colors">
                        <i data-lucide="menu" class="w-5 h-5 text-gray-600"></i>
                    </button>
                    
                    <!-- User Actions -->
                    <div id="header-user-actions" class="flex items-center space-x-2">
                        <!-- This will be dynamically populated by js/app.js -->
                    </div>
                </div>
            </nav>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="hidden md:hidden bg-white/95 backdrop-blur-sm border-t border-gray-200">
                <div class="container mx-auto px-4 py-4 space-y-3">
                    <a href="issues.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="list" class="w-4 h-4 inline mr-2"></i>전체 이슈
                    </a>
                    <a href="tier_guide.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="award" class="w-4 h-4 inline mr-2"></i>업적 안내
                    </a>
                    <a href="mypage.html" class="block px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors">
                        <i data-lucide="user" class="w-4 h-4 inline mr-2"></i>내 정보
                    </a>
                    <a href="admin.html" class="block px-3 py-2 text-sm font-medium text-red-600 bg-red-50 rounded-md transition-colors">
                        <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>관리자
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 lg:px-8 py-12">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">관리자 페이지</h1>
                    <p class="text-gray-600">이슈와 댓글을 생성하고 관리할 수 있습니다.</p>
                </div>
                <button id="create-issue-btn" class="btn-primary">
                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                    새 이슈 생성
                </button>
            </div>
            
            <!-- 관리 탭 -->
            <div class="mb-8">
                <nav class="flex space-x-8 overflow-x-auto">
                    <button id="issues-tab" class="admin-tab active pb-4 border-b-2 border-blue-500 text-blue-600 font-medium whitespace-nowrap">
                        이슈 관리
                    </button>
                    <button id="issue-requests-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        이슈 신청 관리
                    </button>
                    <button id="results-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        결과 관리
                    </button>
                    <button id="comments-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        댓글 관리
                    </button>
                    <button id="scheduler-tab" class="admin-tab pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap">
                        스케줄러 관리
                    </button>
                </nav>
            </div>

            <!-- 새 이슈 생성 폼 -->
            <div id="create-issue-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">새 이슈 생성</h2>
                            <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <form id="create-issue-form" class="p-6 space-y-6">
                        <div>
                            <label for="issue-title" class="block text-sm font-medium text-gray-700 mb-2">이슈 제목</label>
                            <input type="text" id="issue-title" name="title" class="modern-input w-full" placeholder="예: 비트코인, 2025년 내 20만 달러 돌파할까?" required>
                        </div>
                        <div>
                            <label for="issue-category" class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                            <select id="issue-category" name="category" class="modern-select w-full" required>
                                <option value="">카테고리 선택</option>
                                <option value="정치">정치</option>
                                <option value="스포츠">스포츠</option>
                                <option value="경제">경제</option>
                                <option value="코인">코인</option>
                                <option value="테크">테크</option>
                                <option value="엔터">엔터</option>
                                <option value="날씨">날씨</option>
                                <option value="해외">해외</option>
                            </select>
                        </div>
                        <div>
                            <label for="issue-end-date" class="block text-sm font-medium text-gray-700 mb-2">마감일</label>
                            <input type="datetime-local" id="issue-end-date" name="endDate" class="modern-input w-full" required>
                        </div>
                        <div>
                            <label for="issue-description" class="block text-sm font-medium text-gray-700 mb-2">설명 (선택사항)</label>
                            <textarea id="issue-description" name="description" class="modern-input w-full" rows="3" placeholder="이슈에 대한 상세 설명"></textarea>
                        </div>
                        <div>
                            <label for="issue-image" class="block text-sm font-medium text-gray-700 mb-2">이미지 업로드 (선택사항)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <input type="file" id="issue-image" name="image" accept="image/*" class="hidden">
                                <input type="hidden" id="image-url" name="imageUrl" value="">
                                <div id="image-preview" class="hidden mb-4">
                                    <img id="preview-img" src="" alt="미리보기" class="mx-auto max-h-32 rounded">
                                    <button type="button" id="remove-image" class="mt-2 text-red-600 text-sm">이미지 제거</button>
                                </div>
                                <div id="upload-area" class="cursor-pointer" onclick="document.getElementById('issue-image').click()">
                                    <i data-lucide="upload" class="w-8 h-8 mx-auto text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-600">클릭하여 이미지를 업로드하거나 드래그 앤 드롭하세요</p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG (최대 5MB)</p>
                                </div>
                                <div id="upload-progress" class="hidden mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    <p class="text-xs text-gray-600 mt-1">업로드 중...</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="issue-yes-price" class="block text-sm font-medium text-gray-700 mb-2">초기 Yes 확률 (%)</label>
                            <input type="number" id="issue-yes-price" name="yesPrice" class="modern-input w-full" min="1" max="99" value="50" required>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="issue-popular" name="isPopular" class="mr-2">
                            <label for="issue-popular" class="text-sm text-gray-700">인기 이슈로 표시</label>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="btn-primary flex-1">이슈 생성</button>
                            <button type="button" id="cancel-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">취소</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 이슈 수정 모달 -->
            <div id="edit-issue-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">이슈 수정</h2>
                            <button id="close-edit-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <form id="edit-issue-form" class="p-6 space-y-6">
                        <input type="hidden" id="edit-issue-id" name="issueId">
                        <div>
                            <label for="edit-issue-title" class="block text-sm font-medium text-gray-700 mb-2">이슈 제목</label>
                            <input type="text" id="edit-issue-title" name="title" class="modern-input w-full" required>
                        </div>
                        <div>
                            <label for="edit-issue-category" class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                            <select id="edit-issue-category" name="category" class="modern-select w-full" required>
                                <option value="">카테고리 선택</option>
                                <option value="정치">정치</option>
                                <option value="스포츠">스포츠</option>
                                <option value="경제">경제</option>
                                <option value="코인">코인</option>
                                <option value="테크">테크</option>
                                <option value="엔터">엔터</option>
                                <option value="날씨">날씨</option>
                                <option value="해외">해외</option>
                            </select>
                        </div>
                        <div>
                            <label for="edit-issue-end-date" class="block text-sm font-medium text-gray-700 mb-2">마감일</label>
                            <input type="datetime-local" id="edit-issue-end-date" name="endDate" class="modern-input w-full" required>
                        </div>
                        <div>
                            <label for="edit-issue-description" class="block text-sm font-medium text-gray-700 mb-2">설명 (선택사항)</label>
                            <textarea id="edit-issue-description" name="description" class="modern-input w-full" rows="3"></textarea>
                        </div>
                        <div>
                            <label for="edit-issue-image" class="block text-sm font-medium text-gray-700 mb-2">이미지 업로드 (선택사항)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <input type="file" id="edit-issue-image" name="image" accept="image/*" class="hidden">
                                <input type="hidden" id="edit-image-url" name="imageUrl" value="">
                                <div id="edit-image-preview" class="hidden mb-4">
                                    <img id="edit-preview-img" src="" alt="미리보기" class="mx-auto max-h-32 rounded">
                                    <button type="button" id="edit-remove-image" class="mt-2 text-red-600 text-sm">이미지 제거</button>
                                </div>
                                <div id="edit-upload-area" class="cursor-pointer" onclick="document.getElementById('edit-issue-image').click()">
                                    <i data-lucide="upload" class="w-8 h-8 mx-auto text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-600">클릭하여 이미지를 업로드하거나 드래그 앤 드롭하세요</p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG (최대 5MB)</p>
                                </div>
                                <div id="edit-upload-progress" class="hidden mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    <p class="text-xs text-gray-600 mt-1">업로드 중...</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="edit-issue-yes-price" class="block text-sm font-medium text-gray-700 mb-2">초기 Yes 확률 (%)</label>
                            <input type="number" id="edit-issue-yes-price" name="yesPrice" class="modern-input w-full" min="1" max="99" required>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="edit-issue-popular" name="isPopular" class="mr-2">
                            <label for="edit-issue-popular" class="text-sm text-gray-700">인기 이슈로 표시</label>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="btn-primary flex-1">이슈 수정</button>
                            <button type="button" id="edit-cancel-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">취소</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 이슈 관리 테이블 -->
            <div id="issues-section" class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">이슈 관리</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이슈</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">마감시간</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yes 확률</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">참여량</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="issues-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 이슈 목록이 여기에 동적으로 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 이슈 신청 관리 섹션 -->
            <div id="issue-requests-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">이슈 신청 관리</h3>
                        <p class="text-sm text-gray-600 mt-1">사용자가 신청한 이슈를 검토하고 승인/거부할 수 있습니다</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <select id="request-status-filter" class="text-sm border border-gray-300 rounded-md px-3 py-1">
                            <option value="all">전체 상태</option>
                            <option value="pending" selected>대기 중</option>
                            <option value="approved">승인됨</option>
                            <option value="rejected">거부됨</option>
                        </select>
                        <button id="refresh-requests-btn" class="btn-secondary text-sm">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>
                            새로고침
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">신청 정보</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">신청자</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">마감일</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="issue-requests-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 이슈 신청 목록이 여기에 로드됩니다 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 이슈 신청이 없을 때 -->
                <div id="no-requests-message" class="hidden text-center py-12">
                    <i data-lucide="inbox" class="w-12 h-12 mx-auto text-gray-300 mb-4"></i>
                    <p class="text-gray-500">현재 이슈 신청이 없습니다.</p>
                </div>
                
                <!-- 로딩 상태 -->
                <div id="requests-loading" class="text-center py-12">
                    <i data-lucide="loader" class="w-6 h-6 animate-spin mx-auto mb-2 text-gray-400"></i>
                    <p class="text-gray-500">이슈 신청을 불러오는 중...</p>
                </div>
            </div>
            
            <!-- 이슈 신청 상세 모달 -->
            <div id="request-detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">이슈 신청 상세</h2>
                            <button id="close-request-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <div id="request-detail-content" class="p-6">
                        <!-- 상세 내용이 여기에 로드됩니다 -->
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button id="reject-request-btn" class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition-colors">
                            거부
                        </button>
                        <button id="approve-request-btn" class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 transition-colors">
                            승인 (1000 GAM 지급)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 결과 관리 섹션 -->
            <div id="results-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">이슈 결과 관리</h3>
                        <p class="text-sm text-gray-600 mt-1">마감된 이슈의 결과를 결정하고 보상을 지급합니다</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <select id="result-filter" class="text-sm border border-gray-300 rounded-md px-3 py-1">
                            <option value="closed">마감된 이슈</option>
                            <option value="pending">결과 대기</option>
                            <option value="resolved">결과 확정</option>
                            <option value="all">모든 이슈 (디버깅)</option>
                        </select>
                        <button id="refresh-results" class="text-sm text-gray-600 hover:text-gray-900">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>
                            새로고침
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이슈</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">마감일</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">참여 현황</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">결과</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="results-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 결과 관리 목록이 여기에 동적으로 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 이슈 결과 입력 모달 -->
            <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg max-w-lg w-full">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-bold text-gray-900">이슈 결과 결정</h2>
                            <button id="close-result-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <form id="result-form" class="p-6 space-y-6">
                        <input type="hidden" id="result-issue-id" name="issueId">
                        
                        <!-- 이슈 정보 표시 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 id="result-issue-title" class="font-medium text-gray-900 mb-2"></h3>
                            <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <span class="font-medium">카테고리:</span>
                                    <span id="result-issue-category" class="ml-1"></span>
                                </div>
                                <div>
                                    <span class="font-medium">마감일:</span>
                                    <span id="result-issue-end-date" class="ml-1"></span>
                                </div>
                            </div>
                        </div>

                        <!-- 결과 선택 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">결과 선택</label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="relative">
                                    <input type="radio" name="result" value="Yes" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 text-center">
                                        <div class="text-2xl mb-2">✅</div>
                                        <div class="font-medium text-green-600">Yes</div>
                                        <div class="text-sm text-gray-500">이슈가 실현됨</div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="result" value="No" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-red-300 text-center">
                                        <div class="text-2xl mb-2">❌</div>
                                        <div class="font-medium text-red-600">No</div>
                                        <div class="text-sm text-gray-500">이슈가 실현되지 않음</div>
                                    </div>
                                </label>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mt-3">
                                <label class="relative">
                                    <input type="radio" name="result" value="Draw" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-yellow-300 text-center">
                                        <div class="text-2xl mb-2">⚖️</div>
                                        <div class="font-medium text-yellow-600">무승부</div>
                                        <div class="text-sm text-gray-500">판단 불가능</div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="result" value="Cancelled" class="sr-only">
                                    <div class="result-option p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gray-400 text-center">
                                        <div class="text-2xl mb-2">🚫</div>
                                        <div class="font-medium text-gray-600">취소</div>
                                        <div class="text-sm text-gray-500">이슈 취소</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 결정 사유 -->
                        <div>
                            <label for="result-reason" class="block text-sm font-medium text-gray-700 mb-2">결정 사유</label>
                            <textarea id="result-reason" name="reason" class="modern-input w-full" rows="3" placeholder="결과를 결정한 이유를 입력하세요" required></textarea>
                        </div>

                        <!-- 버튼 -->
                        <div class="flex space-x-3 pt-4">
                            <button type="submit" class="btn-primary flex-1">결과 확정 및 보상 지급</button>
                            <button type="button" id="result-cancel-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">취소</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 댓글 관리 섹션 -->
            <div id="comments-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">댓글 관리</h3>
                    <div class="flex items-center space-x-4">
                        <select id="comment-filter" class="text-sm border border-gray-300 rounded-md px-3 py-1">
                            <option value="all">전체 댓글</option>
                            <option value="reported">신고된 댓글</option>
                            <option value="highlighted">강조된 댓글</option>
                        </select>
                        <button id="refresh-comments" class="text-sm text-gray-600 hover:text-gray-900">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>
                            새로고침
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">댓글</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성자</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이슈</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">좋아요</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작성일</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody id="comments-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- 댓글 목록이 여기에 동적으로 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
                <div id="comments-loading" class="hidden flex items-center justify-center py-8">
                    <i data-lucide="loader" class="w-6 h-6 animate-spin mr-2"></i>
                    <span class="text-gray-600">댓글을 불러오는 중...</span>
                </div>
                <div id="comments-empty" class="hidden text-center py-8 text-gray-500">
                    <i data-lucide="message-circle" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p>댓글이 없습니다.</p>
                </div>
            </div>
            
            <!-- 스케줄러 관리 섹션 -->
            <div id="scheduler-section" class="hidden bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">이슈 자동 마감 스케줄러</h3>
                        <p class="text-sm text-gray-600 mt-1">만료된 이슈를 자동으로 마감 처리하는 스케줄러를 관리합니다</p>
                    </div>
                </div>
                <div class="p-6 space-y-6">
                    <!-- 스케줄러 상태 -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-md font-medium text-gray-900 mb-3">스케줄러 상태</h4>
                        <div id="scheduler-status" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white p-3 rounded border">
                                <div class="text-sm text-gray-600">상태</div>
                                <div id="scheduler-running-status" class="text-lg font-semibold">
                                    <span class="inline-flex items-center">
                                        <i data-lucide="loader" class="w-4 h-4 animate-spin mr-2"></i>
                                        확인 중...
                                    </span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <div class="text-sm text-gray-600">다음 실행</div>
                                <div id="scheduler-next-run" class="text-lg font-semibold text-gray-900">-</div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <div class="text-sm text-gray-600">현재 시간</div>
                                <div id="scheduler-current-time" class="text-lg font-semibold text-gray-900">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 스케줄러 액션 -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-md font-medium text-gray-900 mb-3">수동 작업</h4>
                        <div class="flex space-x-3">
                            <button id="manual-check-btn" class="btn-primary">
                                <i data-lucide="play" class="w-4 h-4 mr-2"></i>
                                수동 마감 검사 실행
                            </button>
                            <button id="refresh-scheduler-status" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">
                                <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                                상태 새로고침
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">
                            수동 마감 검사를 실행하면 현재 시간 기준으로 만료된 모든 이슈를 즉시 마감 처리합니다.
                        </p>
                    </div>
                    
                    <!-- 스케줄러 로그 -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-md font-medium text-gray-900 mb-3">최근 활동</h4>
                        <div id="scheduler-logs" class="bg-white p-3 rounded border max-h-48 overflow-y-auto">
                            <div class="text-sm text-gray-500">로그가 없습니다.</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-50 border-t border-gray-200">
            <div class="container mx-auto px-4 lg:px-8 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left space-y-4 md:space-y-0">
                    <div>
                        <a href="index.html" class="flex items-center justify-center md:justify-start space-x-2 mb-2">
                             <img src="https://github.com/ddoriboo/yegam/raw/refs/heads/main/logo.png" alt="예겜 Logo" class="h-6 w-auto">
                             <span class="font-semibold text-gray-900">예겜</span>
                        </a>
                        <p class="text-xs text-gray-500 max-w-md">본 서비스는 현금 베팅을 제공하지 않는 예측 정보 플랫폼이며, 사용되는 GAM은 환전 및 현금화가 불가능한 사이버 자산입니다.</p>
                    </div>
                    <div class="flex space-x-6 text-sm text-gray-500">
                        <a href="#" class="hover:text-gray-900 transition-colors">사이트 정보</a>
                        <a href="#" class="hover:text-gray-900 transition-colors">이용약관</a>
                        <a href="#" class="hover:text-gray-900 transition-colors">개인정보처리방침</a>
                    </div>
                </div>
                <div class="mt-8 border-t border-gray-200 pt-4 text-center text-xs text-gray-500">
                    &copy; 2025 예겜. All Rights Reserved.
                </div>
            </div>
        </footer>

    </div>

    <!-- 관리자 인증 스크립트 (app-working.js보다 먼저 실행) -->
    <script>
        // 관리자 페이지 플래그 설정 (app-working.js에서 확인)
        window.isAdminPage = true;
        window.adminAuthCompleted = false;
        
        // 관리자 인증 확인 함수
        async function checkAdminAuth() {
            const adminToken = localStorage.getItem('admin-token');
            
            if (!adminToken) {
                console.warn('⚠️ 관리자 토큰이 없습니다. 로그인 페이지로 이동합니다.');
                window.location.href = '/admin-login';
                return { success: false };
            }
            
            try {
                const response = await fetch('/api/admin-auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    console.warn('⚠️ 관리자 인증 실패:', data.message);
                    localStorage.removeItem('admin-token');
                    sessionStorage.removeItem('admin-user');
                    window.location.href = '/admin-login';
                    return { success: false };
                }
                
                // 관리자 정보를 세션에 저장
                sessionStorage.setItem('admin-user', JSON.stringify(data.admin));
                console.log('✅ 관리자 인증 성공:', data.admin.username);
                
                // 페이지에 관리자 정보 표시
                updateAdminHeader(data.admin);
                
                return { success: true, admin: data.admin };
                
            } catch (error) {
                console.error('❌ 관리자 인증 확인 중 오류:', error);
                localStorage.removeItem('admin-token');
                sessionStorage.removeItem('admin-user');
                window.location.href = '/admin-login';
                return { success: false };
            }
        }
        
        // 관리자 헤더 업데이트
        function updateAdminHeader(admin) {
            const userActionsContainer = document.getElementById('header-user-actions');
            if (userActionsContainer) {
                userActionsContainer.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center">
                                <i data-lucide="shield-check" class="w-4 h-4 text-white"></i>
                            </div>
                            <div class="hidden sm:block">
                                <div class="text-sm font-medium text-gray-900">${admin.username}</div>
                                <div class="text-xs text-red-600">${admin.role === 'super_admin' ? '슈퍼 관리자' : '관리자'}</div>
                            </div>
                        </div>
                        <button onclick="adminLogout()" class="text-gray-600 hover:text-red-600 transition-colors text-sm font-medium">
                            <i data-lucide="log-out" class="w-4 h-4 mr-1"></i>
                            로그아웃
                        </button>
                    </div>
                `;
                
                // Lucide 아이콘 재생성
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }
        
        // 관리자 로그아웃
        async function adminLogout() {
            const adminToken = localStorage.getItem('admin-token');
            
            if (adminToken) {
                try {
                    await fetch('/api/admin-auth/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`
                        }
                    });
                } catch (error) {
                    console.error('로그아웃 API 호출 실패:', error);
                }
            }
            
            // 로컬 토큰 및 세션 정리
            localStorage.removeItem('admin-token');
            sessionStorage.removeItem('admin-user');
            
            // 로그인 페이지로 이동
            window.location.href = '/admin-login';
        }
        
        // 전역 함수로 노출
        window.adminLogout = adminLogout;
        
        // 관리자 인증을 즉시 실행 (js/app-working.js보다 먼저)
        (async function() {
            console.log('🔐 관리자 페이지 접근 - 인증 확인 중...');
            
            const authResult = await checkAdminAuth();
            if (!authResult.success) {
                return; // 인증 실패 시 리다이렉트됨
            }
            
            console.log('✅ 관리자 인증 완료 - 사용자 정보 설정 중...');
            
            // 관리자 인증 완료 플래그 설정 (app-working.js에서 확인)
            window.adminAuthCompleted = true;
            window.adminAuthenticated = true;
            window.adminUser = authResult.admin;
            
            // 일반 사용자 인증 우회를 위한 가짜 사용자 설정
            window.currentUser = {
                id: authResult.admin.id,
                username: authResult.admin.username,
                email: authResult.admin.email,
                coins: 999999, // 관리자는 무제한
                isAdmin: true
            };
            
            // 일반 사용자 토큰도 설정 (app-working.js 호환을 위해)
            localStorage.setItem('yegame-token', localStorage.getItem('admin-token'));
            sessionStorage.setItem('yegame-user', JSON.stringify(window.currentUser));
            
            // app-working.js가 사용하는 전역 변수 미리 설정
            window.userToken = localStorage.getItem('admin-token');
            window.currentUser = window.currentUser; // 이미 설정됨
            
            console.log('🎯 관리자 모드 설정 완료 - app-working.js 로드 준비됨');
            
            // app-working.js 로드 후 헤더 강제 업데이트
            setTimeout(() => {
                if (typeof updateHeader === 'function') {
                    updateHeader(true);
                    console.log('🔄 관리자 헤더 강제 업데이트 완료');
                } else {
                    // updateHeader가 아직 정의되지 않았다면 조금 더 기다림
                    setTimeout(() => {
                        if (typeof updateHeader === 'function') {
                            updateHeader(true);
                            console.log('🔄 관리자 헤더 강제 업데이트 완료 (지연)');
                        }
                    }, 1000);
                }
            }, 500);
        })();
        
        // API 요청 시 관리자 토큰 자동 추가 함수
        window.adminFetch = async function(url, options = {}) {
            const adminToken = localStorage.getItem('admin-token');
            
            if (!adminToken) {
                console.error('❌ 관리자 토큰이 없습니다.');
                throw new Error('관리자 토큰이 없습니다.');
            }
            
            const headers = {
                'Authorization': `Bearer ${adminToken}`,
                ...options.headers
            };
            
            // FormData가 아닌 경우에만 Content-Type 설정
            if (!(options.body instanceof FormData) && !options.headers?.['Content-Type']) {
                headers['Content-Type'] = 'application/json';
            }
            
            console.log(`🔄 관리자 API 요청: ${options.method || 'GET'} ${url}`);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });
                
                console.log(`📡 응답 상태: ${response.status} ${response.statusText}`);
                
                // 401 Unauthorized - 토큰 만료 또는 무효
                if (response.status === 401) {
                    console.warn('⚠️ 관리자 인증 실패 - 토큰이 만료되었거나 무효합니다.');
                    
                    // 응답 내용을 확인해서 실제 인증 문제인지 확인
                    try {
                        const errorData = await response.json();
                        console.warn('401 응답 내용:', errorData);
                        
                        // 명확한 인증 오류인 경우에만 로그아웃
                        if (errorData.message && (
                            errorData.message.includes('토큰') || 
                            errorData.message.includes('인증') ||
                            errorData.message.includes('로그인')
                        )) {
                            console.warn('🚪 관리자 자동 로그아웃 실행');
                            adminLogout();
                        }
                    } catch (e) {
                        // JSON 파싱 실패해도 401이면 로그아웃
                        console.warn('🚪 관리자 자동 로그아웃 실행 (응답 파싱 실패)');
                        adminLogout();
                    }
                    
                    throw new Error('관리자 인증이 만료되었습니다.');
                }
                
                // 다른 오류들은 로그아웃하지 않고 그대로 반환
                if (!response.ok) {
                    console.warn(`⚠️ API 오류: ${response.status} - 로그아웃하지 않음`);
                }
                
                return response;
                
            } catch (error) {
                // 네트워크 오류 등
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    console.error('❌ 네트워크 연결 오류:', error.message);
                    throw new Error('서버에 연결할 수 없습니다. 네트워크를 확인해주세요.');
                }
                
                // 기타 오류는 그대로 전파
                throw error;
            }
        };
    </script>
    
    <script src="utils/tierSystem.js"></script>
    <script type="module" src="js/app-working.js"></script>
</body>
</html>